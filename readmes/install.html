<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>&lt;no title&gt; &mdash; PISA 4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=9f5556dd"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PISA
          </a>
              <div class="version">
                4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PISA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">&lt;no title&gt;</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/readmes/install.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>## Installation Guide</p>
<p>### <strong>Instruction to install PISA on your local machine</strong></p>
<ol class="arabic">
<li><p>Install the essential dependencies</p>
<ol class="arabic">
<li><p>Anaconda (<a class="reference external" href="https://www.anaconda.com/">https://www.anaconda.com/</a>)
<a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>bash
wget -nc <a class="reference external" href="https://repo.anaconda.com/archive/Anaconda3-2023.07-2-Linux-x86_64.sh">https://repo.anaconda.com/archive/Anaconda3-2023.07-2-Linux-x86_64.sh</a></p>
<p>bash Anaconda3-2023.07-2-Linux-x86_64.sh
<a href="#id5"><span class="problematic" id="id6">``</span></a><a href="#id7"><span class="problematic" id="id8">`</span></a></p>
</li>
<li><p>pip (Python package installer)
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">install</span> <span class="pre">pip</span>
<span class="pre">`</span></code></p></li>
<li><p>git
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">sudo</span> <span class="pre">apt</span> <span class="pre">install</span> <span class="pre">git</span>
<span class="pre">`</span></code></p></li>
</ol>
<p>Other required libraries (listed below) will be installed automatically during the setup (listed in <cite>setup.py</cite>).</p>
<ul class="simple">
<li><p>fast-histogram &gt;= 0.10</p></li>
<li><p>h5py</p></li>
<li><p>iminuit &gt;= 2</p></li>
<li><p>line_profiler</p></li>
<li><p>llvmlite</p></li>
<li><p>matplotlib &gt;= 3.0</p></li>
<li><p>nlopt</p></li>
<li><p>numba &gt;= 0.53</p></li>
<li><p>numpy &gt;=1.17, &lt; 1.23</p></li>
<li><p>pandas</p></li>
<li><p>pint &lt;=0.19</p></li>
<li><p>py-cpuinfo</p></li>
<li><p>pyarrow</p></li>
<li><p>scikit-learn &lt;= 1.1.2</p></li>
<li><p>scipy &gt;= 1.6</p></li>
<li><p>simplejson == 3.18.4</p></li>
<li><p>sympy</p></li>
<li><p>tables</p></li>
<li><p>tabulate</p></li>
<li><p>tqdm</p></li>
<li><p>uncertainties</p></li>
<li><p>kiwisolver &gt;= 1.3.1</p></li>
<li><p>cycler &gt;= 0.10</p></li>
<li><p>packaging &gt;= 20.0</p></li>
<li><p>fonttools &gt;= 4.22.0</p></li>
<li><p>python-dateutil &gt;= 2.7</p></li>
<li><p>pillow &gt;= 8</p></li>
<li><p>contourpy &gt;= 1.0.1</p></li>
<li><p>pyparsing &gt;= 2.3.1</p></li>
<li><p>threadpoolctl &gt;= 2.0.0</p></li>
<li><p>joblib &gt;= 1.0.0</p></li>
<li><p>numexpr</p></li>
<li><p>pytz &gt;= 2020.1</p></li>
<li><p>tzdata &gt;= 2022.1</p></li>
<li><p>mpmath &gt;= 0.19</p></li>
<li><p>blosc2 &gt;= 2.3.0</p></li>
<li><p>future</p></li>
<li><p>ndindex &gt;= 1.4</p></li>
<li><p>msgpack</p></li>
<li><p>six &gt;= 1.5</p></li>
</ul>
</li>
<li><p>Create conda environment/ virtual environment for the installation of PISA. Assume that the name of the environment is <cite>pisa_env</cite> you can choose your preferred version of python &gt;= 3.10</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">create</span> <span class="pre">-n</span> <span class="pre">pisa_env</span> <span class="pre">python=3.10</span>
<span class="pre">`</span></code></p>
<ol class="arabic simple" start="3">
<li><p>Activate the newly created environment (You can see the name of your environment in the bash shell after the activation)</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">pisa_env</span>
<span class="pre">`</span></code></p>
<ol class="arabic simple" start="4">
<li><p>Clone the PISA repository from github (<a class="reference external" href="https://github.com/icecube/pisa.git">https://github.com/icecube/pisa.git</a>)</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/icecube/pisa.git</span>
<span class="pre">`</span></code></p>
<ol class="arabic simple" start="5">
<li><p>Install PISA with the following command</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">pisa</span>
<span class="pre">`</span></code></p>
<p>Arguments:</p>
<ul class="simple">
<li><p><a href="#id9"><span class="problematic" id="id10">`</span></a>pisa ` directory of source code</p></li>
<li><p><cite>-e</cite>  (editable) Installs from source located at <cite>$PISA</cite> (Installed directory - pisa) and  allows for changes to the source code within to be immediately propagated to your Python installation.</p></li>
<li><p><cite>-vvv</cite> Be maximally verbose during the install. You’ll see lots of messages, including warnings that are irrelevant, but if your installation fails, it’s easiest to debug if you use <cite>-vvv</cite></p></li>
<li><p><cite>[develop]</cite> Specify optional dependency groups. You can omit any or all of these if your system does not support them or if you do not need them.</p></li>
</ul>
<p>### <strong>Test your installation by running a simple script:</strong></p>
<ul>
<li><p>Activate your python environment (<cite>pisa_env</cite>)</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">conda</span> <span class="pre">activate</span> <span class="pre">pisa_env</span>
<span class="pre">`</span></code></p>
</li>
<li><p>Start python interpretator in terminal</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">python</span>
<span class="pre">`</span></code></p>
</li>
<li><p>Import <cite>Pipline</cite> modelue and <cite>matplotlib.pyplot</cite></p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">from</span> <span class="pre">pisa.core</span> <span class="pre">import</span> <span class="pre">Pipeline</span>
<span class="pre">import</span> <span class="pre">matplotlib.pyplot</span> <span class="pre">as</span> <span class="pre">plt</span>
<span class="pre">`</span></code>
<code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">&lt;&lt;</span> <span class="pre">PISA</span> <span class="pre">is</span> <span class="pre">running</span> <span class="pre">in</span> <span class="pre">single</span> <span class="pre">precision</span> <span class="pre">(FP32)</span> <span class="pre">mode;</span> <span class="pre">numba</span> <span class="pre">is</span> <span class="pre">running</span> <span class="pre">on</span> <span class="pre">CPU</span> <span class="pre">(single</span> <span class="pre">core)</span> <span class="pre">&gt;&gt;</span>
<span class="pre">`</span></code></p>
</li>
<li><p>Load an example pipeline</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">template_maker</span> <span class="pre">=</span> <span class="pre">Pipeline(&quot;settings/pipeline/osc_example.cfg&quot;)</span>
<span class="pre">`</span></code></p>
</li>
<li><p>Run the pipeline</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">template_maker.run()</span>
<span class="pre">`</span></code></p>
</li>
<li><p>Get the oscillation probabilities as a map</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">outputs</span> <span class="pre">=</span> <span class="pre">template_maker.data.get_mapset('prob_mu')</span>
<span class="pre">`</span></code></p>
</li>
<li><p>Plot the oscillogram</p>
<p><code class="docutils literal notranslate"><span class="pre">`python</span>
<span class="pre">fig,</span> <span class="pre">axes</span> <span class="pre">=</span> <span class="pre">plt.subplots(figsize=(18,</span> <span class="pre">5),</span> <span class="pre">ncols=3)</span>
<span class="pre">outputs['nue_cc'].plot(ax=axes[0],</span> <span class="pre">cmap='RdYlBu_r',</span> <span class="pre">vmin=0,</span> <span class="pre">vmax=1);</span>
<span class="pre">outputs['numu_cc'].plot(ax=axes[1],</span> <span class="pre">cmap='RdYlBu_r',</span> <span class="pre">vmin=0,</span> <span class="pre">vmax=1);</span>
<span class="pre">outputs['nutau_cc'].plot(ax=axes[2],</span> <span class="pre">cmap='RdYlBu_r',</span> <span class="pre">vmin=0,</span> <span class="pre">vmax=1);</span>
<span class="pre">`</span></code></p>
</li>
</ul>
<p>### Instructions to install PISA on Madison working group servers cobalts (current guide from August 2023):</p>
<p>Assuming you already are in the directory where you want to store fridge/pisa source files and the python virtualenv and build pisa. You also need access to github through your account.</p>
<p>#### Clone into the fridge and pisa (ideally your own fork):</p>
<p><a href="#id11"><span class="problematic" id="id12">``</span></a>`
git clone <a class="reference external" href="mailto:git&#37;&#52;&#48;github&#46;com">git<span>&#64;</span>github<span>&#46;</span>com</a>:icecube/wg-oscillations-fridge.git ./fridge</p>
<p>git clone <a class="reference external" href="mailto:git&#37;&#52;&#48;github&#46;com">git<span>&#64;</span>github<span>&#46;</span>com</a>:USERNAME/pisa.git ./pisa
<a href="#id13"><span class="problematic" id="id14">``</span></a><a href="#id15"><span class="problematic" id="id16">`</span></a></p>
<p>#### Load cvmfs environment:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">unset</span> <span class="pre">OS_ARCH;</span> <span class="pre">eval</span> <span class="pre">`/cvmfs/icecube.opensciencegrid.org/py3-v4.2.1/setup.sh`</span>
<span class="pre">`</span></code></p>
<p><cite>which python</cite> should now point to <cite>/cvmfs/icecube.opensciencegrid.org/py3-v4.2.1/RHEL_7_x86_64/bin/python</cite></p>
<p><strong>Note:</strong> It’s not tested whether this works with a cvmfs version newer than <cite>py3-v4.2.1</cite>.</p>
<p>#### Create virtual environment:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">python</span> <span class="pre">-m</span> <span class="pre">venv</span> <span class="pre">./YOUR_PISA_PY3_VENV</span>
<span class="pre">`</span></code></p>
<p>#### Start the virtual environment and install pisa from source:</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">source</span> <span class="pre">./YOUR_PISA_PY3_VENV/bin/activate</span>
<span class="pre">`</span></code></p>
<p>(should now show that you are in the environment)</p>
<p><code class="docutils literal notranslate"><span class="pre">`</span>
<span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">pisa</span>
<span class="pre">`</span></code></p>
<p>#### Modify your environment by adding lines to <cite>./YOUR_PISA_PY3_VENV/bin/activate</cite></p>
<p>Every time you want to use pisa now, you need to activate your virtual environment by running <cite>source ./YOUR_PISA_PY3_VENV/bin/activate</cite>. In order to set some useful environment variables you might want to add the following lines (or more if needed) to the end of the <cite>./YOUR_PISA_PY3_VENV/bin/activate</cite> script:</p>
<p><a href="#id17"><span class="problematic" id="id18">``</span></a>`
# PISA source
export PISA=”/data/user/USERNAME/PATH_TO_PISA”</p>
<p># set some custom environment variables and load fridge
export PISA_RESOURCES=”/data/user/USERNAME/PATH_TO_FRIDGE/analysis/common”
export PISA_RESOURCES=$PISA_RESOURCES:”/data/user/USERNAME/PATH_TO_FRIDGE/analysis”</p>
<p>source “/data/user/USERNAME/PATH_TO_FRIDGE/setup_fridge.sh”</p>
<p># Add this project to the python path
export PYTHONPATH=$FRIDGE_DIR:$PYTHONPATH</p>
<p># Madison
export PISA_RESOURCES=/data/ana/LE:$PISA_RESOURCES
export PISA_RESOURCES=/data/ana/BSM/HNL/:$PISA_RESOURCES</p>
<p>export PISA_RESOURCES=$FRIDGE_DIR:$FRIDGE_DIR/analysis:$FRIDGE_DIR/analysis/YOUR_ANALYSIS/settings:$FRIDGE_DIR/analysis/YOUR_ANALYSIS/analysis:$FRIDGE_DIR/analysis/common:$PISA_RESOURCES</p>
<p>export PISA_CACHE=~/cache/
export PISA_FTYPE=fp64
export HDF5_USE_FILE_LOCKING=’FALSE’
<a href="#id19"><span class="problematic" id="id20">``</span></a><a href="#id21"><span class="problematic" id="id22">`</span></a></p>
<p>#### Install any additional packages that you might want</p>
<p><cite>pip install PACKAGE</cite> (for example <cite>jupyter</cite>)</p>
<p>### Quickstart (old guide)</p>
<p>_Note that terminal commands below are intended for the bash shell. You’ll have to translate if you use a different shell._</p>
<ol class="arabic">
<li><dl>
<dt>Obtain a github user ID if you don’t have one already&lt;br&gt;</dt><dd><p><a class="reference external" href="https://github.com">https://github.com</a>
* Sign up for Github education pack for many features for free, too&lt;br&gt;</p>
<blockquote>
<div><p><a class="reference external" href="https://education.github.com/pack">https://education.github.com/pack</a></p>
</div></blockquote>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Fork PISA on github so you have your own copy to work from&lt;br&gt;</dt><dd><p><a class="reference external" href="https://github.com/IceCubeOpenSource/pisa#fork-destination-box">https://github.com/IceCubeOpenSource/pisa#fork-destination-box</a></p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple">
<li><dl class="simple">
<dt>_(optional)_ Set up shared-key ssh access to github so you don’t have to enter passwords&lt;br&gt;</dt><dd><p><a class="reference external" href="https://help.github.com/articles/connecting-to-github-with-ssh">https://help.github.com/articles/connecting-to-github-with-ssh</a></p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple">
<li><dl class="simple">
<dt>In your terminal, define a directory for PISA sourcecode to live in. For example:&lt;br&gt;</dt><dd><p><cite>export PISA=”~/src/pisa”</cite>
* Add this line to your ~/.bashrc file so you can refer to the <cite>$PISA</cite> variable without doing this everytime.</p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Create the directory&lt;br&gt;</dt><dd><p><cite>mkdir -p $PISA</cite></p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic">
<li><dl>
<dt>Clone the PISA repo to your local computer (at command line)</dt><dd><ul class="simple">
<li><p>If you set up shared-key auth above&lt;br&gt;</p></li>
</ul>
<p><cite>git clone git&#64;github.com:&lt;YOUR GITHUB USER ID HERE&gt;/pisa.git $PISA</cite>
* Otherwise&lt;br&gt;
<cite>git clone https://github.com/&lt;YOUR GITHUB USER ID HERE&gt;/pisa.git $PISA</cite></p>
</dd>
</dl>
</li>
</ol>
<ol class="arabic simple">
<li><dl class="simple">
<dt>Install the <strong>*Python 3.7 / 64 bit*</strong> Anaconda or Miniconda python distribution for either Mac or Linux (as your user, _not_ as root), if you don’t have it already</dt><dd><ul class="simple">
<li><dl class="simple">
<dt>Anaconda (full-featured Python distribution, ~500 MB)&lt;br&gt;</dt><dd><p><a class="reference external" href="https://www.anaconda.com/download">https://www.anaconda.com/download</a></p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Miniconda (just the essentials, ~40 MB)&lt;br&gt;</dt><dd><p><a class="reference external" href="https://conda.io/miniconda.html">https://conda.io/miniconda.html</a></p>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ol>
<p>1. Create a new conda environment, ideally with a python version compatible with the python requirements below (cf. conda’s getting started guide).
1. Active your new conda environment.
1. Install PISA including optional packages and development tools (<cite>develop</cite>), if desired&lt;br&gt;</p>
<blockquote>
<div><p><cite>pip install -e $PISA[develop] -vvv</cite></p>
</div></blockquote>
<p>1. Run a quick test: generate templates in the staged mode&lt;br&gt;
<cite>$PISA/pisa/core/pipeline.py –pipeline settings/pipeline/example.cfg  –outdir /tmp/pipeline_output –intermediate –pdf -v</cite></p>
<p>See [github.com/IceCubeOpenSource/pisa/wiki/installation_specific_examples](<a class="reference external" href="https://github.com/IceCubeOpenSource/pisa/wiki/installation_specific_examples">https://github.com/IceCubeOpenSource/pisa/wiki/installation_specific_examples</a>) for users’ recipes for installing PISA under various circumstances.
Please add notes there and/or add your own recipe if your encounter a unique installation issue.
Also, for instructions on running PISA on Open Science Grid (OSG) nodes, see [github.com/IceCubeOpenSource/pisa/wiki/Running-PISA-on-GRID-nodes-with-access-to-CVMFS](<a class="reference external" href="https://github.com/jllanfranchi/pisa/wiki/Running-PISA-on-GRID-nodes-with-access-to-CVMFS">https://github.com/jllanfranchi/pisa/wiki/Running-PISA-on-GRID-nodes-with-access-to-CVMFS</a>)</p>
<p>The following sections delve into deeper detail on installing PISA.</p>
<p>### Python Distributions</p>
<p>Obtaining Python and Python packages, and handling interdependencies in those packages tends to be easiest if you use a Python distribution, such as [Anaconda](<a class="reference external" href="https://www.continuum.io/downloads">https://www.continuum.io/downloads</a>) or [Canopy](<a class="reference external" href="https://www.enthought.com/products/canopy">https://www.enthought.com/products/canopy</a>).
Although the selection of maintained packages is smaller than if you use the <cite>pip</cite> command to obtain packages from the Python Package Index (PyPi), you can still use <cite>pip</cite> with these distributions.</p>
<p>The other advantage to these distributions is that they easily install without system administrative privileges (and install in a user directory) and come with the non-Python binary libraries upon which many Python modules rely, making them ideal for setup on e.g. clusters.</p>
<ul class="simple">
<li><p><strong>Note</strong>: Make sure that your <cite>PATH</cite> variable points to e.g. <cite>&lt;anaconda_install_dr&gt;/bin</cite> and <em>not</em> your system Python directory. To check this, type: <cite>echo $PATH</cite>; to udpate it, add <cite>export PATH=&lt;anaconda_install_dir&gt;/bin:$PATH</cite> to your .bashrc file.</p></li>
<li><p>Python 3.7.x can also be found from the Python website [python.org/downloads](<a class="reference external" href="https://www.python.org/downloads/">https://www.python.org/downloads/</a>) or pre-packaged for almost any OS.</p></li>
</ul>
<p>### Required Dependencies</p>
<p>To install PISA, you’ll need to have the following non-python requirements.
Note that these are not installed automatically, and you must install them yourself prior to installing PISA.
Also note that Python, HDF5, and pip support come pre-packaged or as <cite>conda</cite>-installable packages in the Anaconda Python distribution.
* [python](<a class="reference external" href="http://www.python.org">http://www.python.org</a>) — version 3.x</p>
<blockquote>
<div><ul class="simple">
<li><p>Anaconda: built in</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>[pip](<a class="reference external" href="https://pip.pypa.io">https://pip.pypa.io</a>) version &gt;= 1.8 required
* Anaconda:&lt;br&gt;</p>
<blockquote>
<div><p><cite>conda install pip</cite></p>
</div></blockquote>
</li>
<li><p>[git](<a class="reference external" href="https://git-scm.com">https://git-scm.com</a>)
* In Ubuntu,&lt;br&gt;</p>
<blockquote>
<div><p><cite>sudo apt install git</cite></p>
</div></blockquote>
</li>
<li><p>[hdf5](<a class="reference external" href="http://www.hdfgroup.org/HDF5">http://www.hdfgroup.org/HDF5</a>) — install with <cite>–enable-cxx</cite> option
* In Ubuntu,&lt;br&gt;</p>
<blockquote>
<div><p><cite>sudo apt install libhdf5-10</cite></p>
</div></blockquote>
</li>
<li><p>[llvm](<a class="reference external" href="http://llvm.org">http://llvm.org</a>) Compiler needed by Numba. This is automatically installed in Anaconda alongside <cite>numba</cite>.
* Anaconda&lt;br&gt;</p>
<blockquote>
<div><p><cite>conda install numba=0.45.1</cite></p>
</div></blockquote>
</li>
</ul>
<p>Required Python modules that are installed automatically when you use the <cite>pip</cite> command detailed later:
* [decorator](<a class="reference external" href="https://pypi.python.org/pypi/decorator">https://pypi.python.org/pypi/decorator</a>)
* [h5py](<a class="reference external" href="http://www.h5py.org">http://www.h5py.org</a>)
* [iminuit](): Python interface to the MINUIT2 C++ package, used for proper covariance matrices during minimization
* [kde](<a class="reference external" href="https://github.com/IceCubeOpenSource/kde">https://github.com/IceCubeOpenSource/kde</a>)</p>
<blockquote>
<div><ul>
<li><p>You can install the <cite>kde</cite> module manually if it fails to install automatically:
* Including CUDA support:&lt;br&gt;</p>
<blockquote>
<div><p><cite>pip install git+https://github.com/icecubeopensource/kde.git#egg=kde[cuda]</cite></p>
</div></blockquote>
<ul class="simple">
<li><p>Without CUDA support:&lt;br&gt;
<cite>pip install git+https://github.com/icecubeopensource/kde.git#egg=kde</cite></p></li>
</ul>
</li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>[line_profiler](<a class="reference external" href="https://pypi.python.org/pypi/line_profiler">https://pypi.python.org/pypi/line_profiler</a>): detailed profiling output&lt;br&gt;
* if automatic pip installation of line_profiler fails, you may want to try <cite>conda install line_profiler</cite> if you are using anaconda</p></li>
<li><p>[matplotlib&gt;=3.0](<a class="reference external" href="http://matplotlib.org">http://matplotlib.org</a>) &gt;= 3.0 required</p></li>
<li><p>[numba==0.53.1](<a class="reference external" href="http://numba.pydata.org">http://numba.pydata.org</a>) Just-in-time compilation of decorated Python functions to native machine code via LLVM. This package is required to use PISA pi; also in cake it can accelerate certain routines significantly. If not using Anaconda to install, you must have LLVM installed already on your system (see above).</p></li>
<li><p>[numpy](<a class="reference external" href="http://www.numpy.org">http://www.numpy.org</a>) version &gt;= 1.17 required</p></li>
<li><p>[pint&gt;=0.8.1](<a class="reference external" href="https://pint.readthedocs.org">https://pint.readthedocs.org</a>) &gt;= 0.8.1 required
* if automatic pip installation of pint fails, you may want to try <cite>conda install pint</cite> if you are using anaconda</p></li>
<li><p>[scipy](<a class="reference external" href="http://www.scipy.org">http://www.scipy.org</a>) version &gt;= 0.17 required</p></li>
<li><p>[setuptools](<a class="reference external" href="https://setuptools.readthedocs.io">https://setuptools.readthedocs.io</a>) version &gt;= 18.5 required</p></li>
<li><p>[simplejson](<a class="reference external" href="https://github.com/simplejson/simplejson">https://github.com/simplejson/simplejson</a>) version &gt;= 3.2.0 required</p></li>
<li><p>[tables](<a class="reference external" href="http://www.pytables.org">http://www.pytables.org</a>)</p></li>
<li><p>[uncertainties](<a class="reference external" href="https://pythonhosted.org/uncertainties">https://pythonhosted.org/uncertainties</a>)</p></li>
<li><p>[py-cpuinfo](<a class="reference external" href="https://pypi.org/project/py-cpuinfo">https://pypi.org/project/py-cpuinfo</a>) retrieve detailed CPU and architecture info for documenting in tests / obtaining results</p></li>
<li><p>[sympy](<a class="reference external" href="https://www.sympy.org/en/">https://www.sympy.org/en/</a>) Used for testing <cite>nsi_params.py</cite></p></li>
</ul>
<p>### Optional Dependencies</p>
<p>Optional dependencies. Some of these must be installed manually prior to installing PISA, and some will be installed automatically by pip, and this seems to vary from system to system. Therefore you can first try to run the installation, and just install whatever pip says it needed, or just use apt, pip, and/or conda to install the below before running the PISA installation.</p>
<ul class="simple">
<li><p>[LeptonWeighter](<a class="reference external" href="https://github.com/icecube/leptonweighter">https://github.com/icecube/leptonweighter</a>) Required for the <cite>data.licloader_weighter</cite> service.</p></li>
<li><p>[MCEq](<a class="reference external" href="http://github.com/afedynitch/MCEq">http://github.com/afedynitch/MCEq</a>) Required for <cite>flux.mceq</cite> service.</p></li>
<li><p>[daemonflux](<a class="reference external" href="https://github.com/mceq-project/daemonflux">https://github.com/mceq-project/daemonflux</a>) Recuired for <cite>flux.daemon_flux</cite> service.</p></li>
<li><p>[nuSQuiDS](<a class="reference external" href="https://github.com/arguelles/nuSQuIDS">https://github.com/arguelles/nuSQuIDS</a>) Required for <cite>osc.nusquids</cite> service.</p></li>
<li><p>[pandas](<a class="reference external" href="https://pandas.pydata.org/">https://pandas.pydata.org/</a>) Required for datarelease (csv) stages.</p></li>
<li><p>[OpenMP](<a class="reference external" href="http://www.openmp.org">http://www.openmp.org</a>) Intra-process parallelization to accelerate code on on multi-core/multi-CPU computers.
* Available from your compiler: gcc supports OpenMP 4.0 and Clang &gt;= 3.8.0 supports OpenMP 3.1. Either version of OpenMP should work, but Clang has yet to be tested for its OpenMP support.</p></li>
<li><p>[Photospline](<a class="reference external" href="https://github.com/icecube/photospline">https://github.com/icecube/photospline</a>) Required for the <cite>flux.airs</cite> service.</p></li>
<li><p>[Pylint](<a class="reference external" href="http://www.pylint.org">http://www.pylint.org</a>): Static code checker and style analyzer for Python code. Note that our (more or less enforced) coding conventions are codified in the pylintrc file in PISA, which will automatically be found and used by Pylint when running on code within a PISA package.&lt;br&gt;
* Installed alongside PISA if you specify option <cite>[‘develop’]</cite> to <cite>pip</cite></p></li>
<li><p>[recommonmark](<a class="reference external" href="http://recommonmark.readthedocs.io/en/latest/">http://recommonmark.readthedocs.io/en/latest/</a>) Translator to allow markdown docs/docstrings to be used; plugin for Sphinx. (Required to compile PISA’s documentation.)
* Installed alongside PISA if you specify option <cite>[‘develop’]</cite> to <cite>pip</cite></p></li>
<li><p>[ROOT &gt;= 6.12.04 with PyROOT](<a class="reference external" href="https://root.cern.ch">https://root.cern.ch</a>) Necessary for <cite>xsec.genie</cite>, <cite>unfold.roounfold</cite> and <cite>absorption.pi_earth_absorption</cite> services, and to read ROOT cross section files in the <cite>crossSections</cite> utils module. Due to a bug in ROOT’s python support (documented here <a class="reference external" href="https://github.com/IceCubeOpenSource/pisa/issues/430">https://github.com/IceCubeOpenSource/pisa/issues/430</a>), you need at least version 6.12.04 of ROOT.</p></li>
<li><p>[Sphinx](<a class="reference external" href="http://www.sphinx-doc.org/en/stable/">http://www.sphinx-doc.org/en/stable/</a>) version &gt;= 1.3
* Installed alongside PISA if you specify option <cite>[‘develop’]</cite> to <cite>pip</cite></p></li>
<li><p>[versioneer](<a class="reference external" href="https://github.com/warner/python-versioneer">https://github.com/warner/python-versioneer</a>) Automatically get versions from git and make these embeddable and usable in code. Note that the install process is unique since it first places <cite>versioneer.py</cite> in the PISA root directory, and then updates source files within the repository to provide static and dynamic version info.
* Installed alongside PISA if you specify option <cite>[‘develop’]</cite> to <cite>pip</cite></p></li>
<li><p>[black](<a class="reference external" href="https://github.com/ambv/black">https://github.com/ambv/black</a>) Format your Python code, _automatically_, with typically very nice results!
* Note this only works in Python3</p></li>
</ul>
<p>### Obtain PISA sourcecode</p>
<p>#### Develop PISA: Fork then clone</p>
<p>If you wish to modify PISA and contribute your code changes back to the PISA project (<em>highly recommended!</em>), fork <cite>IceCubeOpenSource/pisa</cite> from Github.
<em>(How to work with the `cake` branch of PISA will be detailed below.)</em></p>
<p>Forking creates your own version of PISA within your Github account.
You can freely create your own <em>branch</em>, modify the code, and then <em>add</em> and <em>commit</em> changes to that branch within your fork of PISA.
When you want to share your changes with <cite>IceCubeOpenSource/pisa</cite>, you can then submit a <em>pull request</em> to <cite>IceCubeOpenSource/pisa</cite> which can be merged by the PISA administrator (after the code is reviewed and tested, of course).</p>
<ul class="simple">
<li><p>Navigate to the [PISA github page](<a class="reference external" href="https://github.com/IceCubeOpenSource/pisa">https://github.com/IceCubeOpenSource/pisa</a>) and fork the repository by clicking on the ![fork](images/ForkButton.png) button.</p></li>
<li><p>Clone the repository into the <cite>$PISA</cite> directory via one of the following commands (<cite>&lt;github username&gt;</cite> is your Github username):
* either SSH access to repo:&lt;br&gt;</p></li>
</ul>
<p><a href="#id23"><span class="problematic" id="id24">`</span></a>git clone <a class="reference external" href="mailto:git&#37;&#52;&#48;github&#46;com">git<span>&#64;</span>github<span>&#46;</span>com</a>:&lt;github username&gt;/pisa.git $PISA
`</p>
<blockquote>
<div><ul class="simple">
<li><p>or HTTPS access to repo:&lt;br&gt;</p></li>
</ul>
</div></blockquote>
<p><cite>git clone https://github.com/&lt;github username&gt;/pisa.git $PISA</cite></p>
<p>#### Using but not developing PISA: Just clone</p>
<p>If you just wish to pull changes from github (and not submit any changes back), you can just clone the sourcecode without creating a fork of the project.</p>
<ul class="simple">
<li><p>Clone the repository into the <cite>$PISA</cite> directory via one of the following commands:
* either SSH access to repo:&lt;br&gt;</p></li>
</ul>
<dl class="simple">
<dt><cite>git clone git&#64;github.com:IceCubeOpenSource/pisa.git $PISA</cite></dt><dd><ul class="simple">
<li><p>or HTTPS access to repo:&lt;br&gt;</p></li>
</ul>
</dd>
</dl>
<p><cite>git clone https://github.com/IceCubeOpenSource/pisa.git $PISA</cite></p>
<p>### Ensure a clean install using virtualenv or conda env</p>
<p>It is absolutely discouraged to install PISA as a root (privileged) user.
PISA is not vetted for security vulnerabilities, so should always be installed and run as a regular (unprivileged) user.</p>
<p>It is suggested (but not required) that you install PISA within a virtual environment (or in a conda env if you’re using Anaconda or Miniconda Python distributions).
This minimizes cross-contamination by PISA of a system-wide (or other) Python installation with conflicting required package versions, guarantees that you can install PISA as an unprivileged user, guarantees that PISA’s dependencies are met, and allows for multiple versions of PISA to be installed simultaneously (each in a different virtualenv / conda env).</p>
<p>Note that it is also discouraged, but you _can_ install PISA as an unprivileged user using your system-wide Python install with the <cite>–user</cite> option to <cite>pip</cite>.
This is not quite as clean as a virtual environment, and the issue with coflicting package dependency versions remains.</p>
<p>### Install PISA</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">$PISA[develop]</span> <span class="pre">-vvv</span>
<span class="pre">`</span></code>
Explanation:
* First, note that this is <strong>*not run as administrator*</strong>. It is discouraged to do so (and has not been tested this way).
* <cite>-e $PISA</cite> (or equivalently, <cite>–editable $PISA</cite>): Installs from source located at <cite>$PISA</cite> and  allows for changes to the source code within to be immediately propagated to your Python installation.
Within the Python library tree, all files under <cite>pisa</cite> are links to your source code, so changes within your source are seen directly by the Python installation. Note that major changes to your source code (file names or directory structure changing) will require re-installation, though, for the links to be updated (see below for the command for re-installing).
* <cite>[develop]</cite> Specify optional dependency groups. You can omit any or all of these if your system does not support them or if you do not need them.
* <cite>-vvv</cite> Be maximally verbose during the install. You’ll see lots of messages, including warnings that are irrelevant, but if your installation fails, it’s easiest to debug if you use <cite>-vvv</cite>.
* If a specific compiler is set by the <cite>CC</cite> environment variable (<cite>export CC=&lt;path&gt;</cite>), it will be used; otherwise, the <cite>cc</cite> command will be run on the system for compiling C-code.</p>
<p>__Notes:__
* You can work with your installation using the usual git commands (pull, push, etc.). However, these <strong>*won’t recompile*</strong> any of the extension (i.e. pyx, _C/C++_) libraries. See below for how to reinstall PISA when you need these to recompile.</p>
<p>### Reinstall PISA</p>
<p>Sometimes a change within PISA requires re-installation (particularly if a compiled module changes, the below forces re-compilation).</p>
<p><code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">pip</span> <span class="pre">install</span> <span class="pre">-e</span> <span class="pre">$PISA[develop]</span> <span class="pre">--force-reinstall</span> <span class="pre">-vvv</span>
<span class="pre">`</span></code></p>
<p>Note that if files change names or locations, though, the above can still not be enough.
In this case, the old files have to be removed manually (along with any associated <cite>.pyc</cite> files, as Python will use these even if the <cite>.py</cite> files have been removed).</p>
<p>### Compile the documentation</p>
<p>To compile a new version of the documentation to html (pdf and other formats are available by replacing <cite>html</cite> with <cite>pdf</cite>, etc.):
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">cd</span> <span class="pre">$PISA</span> <span class="pre">&amp;&amp;</span> <span class="pre">sphinx-apidoc</span> <span class="pre">-f</span> <span class="pre">-o</span> <span class="pre">docs/source</span> <span class="pre">pisa</span>
<span class="pre">`</span></code></p>
<p>In case code structure has changed, rebuild the apidoc by executing
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">cd</span> <span class="pre">$PISA/docs</span> <span class="pre">&amp;&amp;</span> <span class="pre">make</span> <span class="pre">html</span>
<span class="pre">`</span></code></p>
<p>### Test PISA</p>
<p>#### Unit Tests</p>
<p>Throughout the codebase there are <cite>test_*.py</cite> files and <cite>test_*</cite> functions within various <cite>*.py</cite> files that represent unit tests.
Unit tests are designed to ensure that the basic mechanisms of objects’ functionality work.</p>
<p>These are all run, plus additional tests (takes about 15-20 minutes on a laptop) with the command
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">$PISA/pisa_tests/test_command_lines.sh</span>
<span class="pre">`</span></code></p>
<p>### Run a basic analysis</p>
<p>To make sure that an analysis can be run, try running an Asimov analysis of neutrino mass ordering (NMO) with the following (this takes about one minute on a laptop; note, though, that the result is not terribly accurate due to the use of coarse binning and low Monte Carlo statistics):
<a href="#id25"><span class="problematic" id="id26">``</span></a><a href="#id27"><span class="problematic" id="id28">`</span></a>bash
export PISA_FTYPE=fp64
$PISA/pisa/analysis/hypo_testing.py –logdir /tmp/nmo_test analysis </p>
<blockquote>
<div><p>–h0-pipeline settings/pipeline/example.cfg –h0-param-selections=”ih” –h1-param-selections=”nh” –data-param-selections=”nh” –data-is-mc –min-method slsqp –metric=chi2 –pprint -v</p>
</div></blockquote>
<p><a href="#id29"><span class="problematic" id="id30">``</span></a><a href="#id31"><span class="problematic" id="id32">`</span></a></p>
<p>The above command sets the null hypothesis (h0) to be the inverted hierarchy (ih) and the hypothesis to be tested (h1) to the normal hierarchy (nh).
Meanwhile, the Asimov dataset is derived from the normal hierarchy.</p>
<p>The significance for distinguishing NH from IH in this case (with the crude but fast settings specified) is shown by typing the follwoing command (which should output something close to 4.3):
<code class="docutils literal notranslate"><span class="pre">`bash</span>
<span class="pre">hypo_testing_postprocess.py</span> <span class="pre">--asimov</span> <span class="pre">--detector</span> <span class="pre">&quot;pingu_v39&quot;</span> <span class="pre">--dir</span> <span class="pre">/tmp/nmo_test/hypo*</span>
<span class="pre">`</span></code></p>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The IceCube/PINGU Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>