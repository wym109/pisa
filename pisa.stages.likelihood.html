<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pisa.stages.likelihood package &mdash; PISA 4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=9f5556dd"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pisa.stages.osc package" href="pisa.stages.osc.html" />
    <link rel="prev" title="pisa.stages.flux package" href="pisa.stages.flux.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PISA
          </a>
              <div class="version">
                4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="pisa.html">pisa package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="pisa.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pisa.analysis.html">pisa.analysis package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.core.html">pisa.core package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.scripts.html">pisa.scripts package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="pisa.stages.html">pisa.stages package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.utils.html">pisa.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pisa.html#module-pisa">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PISA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">pisa</a></li>
          <li class="breadcrumb-item"><a href="pisa.html">pisa package</a></li>
          <li class="breadcrumb-item"><a href="pisa.stages.html">pisa.stages package</a></li>
      <li class="breadcrumb-item active">pisa.stages.likelihood package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pisa.stages.likelihood.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pisa-stages-likelihood-package">
<h1>pisa.stages.likelihood package<a class="headerlink" href="#pisa-stages-likelihood-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-pisa.stages.likelihood.generalized_llh_params">
<span id="pisa-stages-likelihood-generalized-llh-params-module"></span><h2>pisa.stages.likelihood.generalized_llh_params module<a class="headerlink" href="#module-pisa.stages.likelihood.generalized_llh_params" title="Link to this heading"></a></h2>
<p>Pisa stage that pre-computes some quantities
needed for the generalized likelihood, and applies
small adjustments to the weight distributions in cases
where the number of mc event per bin is low.</p>
<p>The code does the following, in order:</p>
<ul class="simple">
<li><p>Calculate the number of MC events per bin once,
at the setup time</p></li>
<li><p>Calculate, at setup time, a mean adjustment, based
on the average number of MC events per bin. If the
latter is less than one, adjustment is applied, else
that quantity is equal to zero</p></li>
<li><p>Populate ANY empty mc bin with a pseudo-weight with a
value equal to the maximal weight value of a given
dataset. This correspond to the empty bin strategy #2
described in (1902.08831). Note that empty bin strategy #1
can still be applied later on, if one provides the bin
indices where no datasets have any MC events. This step
runs in the apply function because the value of the pseudo
weight will change during minimization.</p></li>
<li><p>Once this is done, computes the alpha and beta
parameters that are fed into the likelihood</p></li>
</ul>
<p>The stage appends / modifies the following:</p>
<blockquote>
<div><dl class="simple">
<dt>weights: changes the individual weight distribution</dt><dd><p>based on the empty bin filling outcome</p>
</dd>
</dl>
<p>llh_alphas: Map (alpha parameters of the generalized likelihood)</p>
<p>llh_betas: Map (beta parameters of the generalized likelihood)</p>
<p>n_mc_events: Map (number of MC events in each bin</p>
<dl class="simple">
<dt>new_sum: Map (Sum of the weights in each bin (ie MC expectation),</dt><dd><p>corrected for the empty bin filling and the mean
adjustment</p>
</dd>
</dl>
</div></blockquote>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.likelihood.generalized_llh_params.generalized_llh_params">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.likelihood.generalized_llh_params.</span></span><span class="sig-name descname"><span class="pre">generalized_llh_params</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/likelihood/generalized_llh_params.html#generalized_llh_params"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.likelihood.generalized_llh_params.generalized_llh_params" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Pisa stage that applies mean adjustment and
empty bin filling. Also computes alphas and betas
that are needed by the generalized poisson likelihood</p>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.likelihood.generalized_llh_params.generalized_llh_params.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/likelihood/generalized_llh_params.html#generalized_llh_params.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.likelihood.generalized_llh_params.generalized_llh_params.apply_function" title="Link to this definition"></a></dt>
<dd><p>Computes the main inputs to the generalized likelihood
function on every iteration of the minimizer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.likelihood.generalized_llh_params.generalized_llh_params.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/likelihood/generalized_llh_params.html#generalized_llh_params.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.likelihood.generalized_llh_params.generalized_llh_params.setup_function" title="Link to this definition"></a></dt>
<dd><p>Declare empty containers, determine the number
of MC events in each bin of each dataset and
compute mean adjustment</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.likelihood">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pisa.stages.likelihood" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pisa.stages.flux.html" class="btn btn-neutral float-left" title="pisa.stages.flux package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pisa.stages.osc.html" class="btn btn-neutral float-right" title="pisa.stages.osc package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The IceCube/PINGU Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>