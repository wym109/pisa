<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pisa.stages.aeff package &mdash; PISA 4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=9f5556dd"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pisa.stages.background package" href="pisa.stages.background.html" />
    <link rel="prev" title="pisa.stages.absorption package" href="pisa.stages.absorption.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PISA
          </a>
              <div class="version">
                4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="pisa.html">pisa package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="pisa.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pisa.analysis.html">pisa.analysis package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.core.html">pisa.core package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.scripts.html">pisa.scripts package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="pisa.stages.html">pisa.stages package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.utils.html">pisa.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pisa.html#module-pisa">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PISA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">pisa</a></li>
          <li class="breadcrumb-item"><a href="pisa.html">pisa package</a></li>
          <li class="breadcrumb-item"><a href="pisa.stages.html">pisa.stages package</a></li>
      <li class="breadcrumb-item active">pisa.stages.aeff package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pisa.stages.aeff.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pisa-stages-aeff-package">
<h1>pisa.stages.aeff package<a class="headerlink" href="#pisa-stages-aeff-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-pisa.stages.aeff.aeff">
<span id="pisa-stages-aeff-aeff-module"></span><h2>pisa.stages.aeff.aeff module<a class="headerlink" href="#module-pisa.stages.aeff.aeff" title="Link to this heading"></a></h2>
<p>PISA pi stage to apply effective area weights</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.aeff.aeff.aeff">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.aeff.aeff.</span></span><span class="sig-name descname"><span class="pre">aeff</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/aeff.html#aeff"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.aeff.aeff" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>PISA Pi stage to apply aeff weights.</p>
<p>This combines the detector effective area with the flux weights calculated
in an earlier stage to compute the weights.</p>
<p>Various scalings can be applied for particular event classes. The weight is
then multiplied by the livetime to get an event count.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>params</strong> – <p>Expected params are ..</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">livetime</span> <span class="p">:</span> <span class="n">Quantity</span> <span class="k">with</span> <span class="n">time</span> <span class="n">units</span>
<span class="n">aeff_scale</span> <span class="p">:</span> <span class="n">dimensionless</span> <span class="n">Quantity</span>
<span class="n">nutau_cc_norm</span> <span class="p">:</span> <span class="n">dimensionless</span> <span class="n">Quantity</span>
<span class="n">nutau_norm</span> <span class="p">:</span> <span class="n">dimensionless</span> <span class="n">Quantity</span>
<span class="n">nu_nc_norm</span> <span class="p">:</span> <span class="n">dimensionless</span> <span class="n">Quantity</span>
</pre></div>
</div>
</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.aeff.aeff.aeff.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/aeff.html#aeff.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.aeff.aeff.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.aeff.param">
<span id="pisa-stages-aeff-param-module"></span><h2>pisa.stages.aeff.param module<a class="headerlink" href="#module-pisa.stages.aeff.param" title="Link to this heading"></a></h2>
<p>This is an effective area stage designed for quick studies of how effective
areas affect experimental observables and sensitivities. In addition, it is
supposed to be easily reproducible as it may rely on (phenomenological)
functions or interpolated discrete data points, dependent on energy
(and optionally cosine zenith), and which can thus be used as reference or
benchmark scenarios.</p>
<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.aeff.param.load_aeff_param">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.aeff.param.</span></span><span class="sig-name descname"><span class="pre">load_aeff_param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/param.html#load_aeff_param"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.param.load_aeff_param" title="Link to this definition"></a></dt>
<dd><p>Load aeff parameterisation (energy- or coszen-dependent) from file
or dictionary.
:param source: Source of the parameterization. If string, treat as file path or</p>
<blockquote>
<div><p>resource location and load from the file; this must yield a mapping. If
<cite>source</cite> is a mapping, it is used directly. See notes below on format.</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>aeff_params</strong> – Keys are stringified flavintgroups and values are the callables that
produce aeff when called with energy or coszen values.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p><a class="reference internal" href="pisa.html#pisa.OrderedDict" title="pisa.OrderedDict">OrderedDict</a></p>
</dd>
</dl>
<p class="rubric">Notes</p>
<dl>
<dt>The mapping passed via <cite>source</cite> or loaded therefrom must have the format:</dt><dd><dl class="simple">
<dt>{</dt><dd><p>&lt;flavintgroup_string&gt;: val,
&lt;flavintgroup_string&gt;: val,
…</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>Note that the <cite>transform_groups</cite> (container.name) defined
in a pipeline config file using this must match the groupings defined
above.
<a href="#id1"><span class="problematic" id="id2">`</span></a>val`s can be one of the following:</p>
<blockquote>
<div><ul>
<li><p>Callable with one argument</p></li>
<li><p>String such that <cite>eval(val)</cite> yields a callable with one argument</p></li>
<li><dl>
<dt>Mapping with the format:</dt><dd><dl class="simple">
<dt>{</dt><dd><p>&lt;”energy” or “coszen”&gt;: [sequence of values],
“aeff”: [sequence of values]</p>
</dd>
</dl>
<p>}</p>
</dd>
</dl>
<p>the two sequences are used to form a linear interpolant callable that
maps energy or coszen values to aeff values. The effective area for any
energy or coszen outside the bounds of the corresponding sequence is
assumed to be 0.</p>
</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.aeff.param.param">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.aeff.param.</span></span><span class="sig-name descname"><span class="pre">param</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/param.html#param"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.param.param" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Effective area service based on parameterisation functions stored in a
.json file.
Transforms an input map of a flux of a given flavour (and interaction)
into maps of event rates, according to energy and cosine zenith dependent
effective areas specified by parameterisation functions.
Requires true_energy, true_coszen, and weights to be present in the container.
:param params: Must exclusively have parameters:</p>
<blockquote>
<div><p>aeff_energy_paramfile
aeff_coszen_paramfile
livetime
aeff_scale</p>
</div></blockquote>
<dl class="field-list simple">
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.aeff.param.param.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/param.html#param.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.param.param.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.aeff.weight">
<span id="pisa-stages-aeff-weight-module"></span><h2>pisa.stages.aeff.weight module<a class="headerlink" href="#module-pisa.stages.aeff.weight" title="Link to this heading"></a></h2>
<p>PISA pi stage to apply weights</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.aeff.weight.weight">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.aeff.weight.</span></span><span class="sig-name descname"><span class="pre">weight</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/weight.html#weight"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.weight.weight" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>PISA Pi stage to apply weights.
This assumes a weight has already been calculated.
The weight is then multiplied by the livetime to get an event count.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>params</strong> (<a class="reference internal" href="pisa.core.html#pisa.core.param.ParamSet" title="pisa.core.param.ParamSet"><em>ParamSet</em></a><em> or </em><em>sequence with which to instantiate a ParamSet.</em>) – <p>Expected params are: ..</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">livetime</span> <span class="p">:</span> <span class="n">Quantity</span> <span class="p">[</span><span class="n">time</span><span class="p">]</span>
    <span class="n">Detector</span> <span class="n">livetime</span> <span class="k">for</span> <span class="n">scaling</span> <span class="n">template</span>
<span class="n">weight_scale</span> <span class="p">:</span> <span class="n">Quantity</span> <span class="p">[</span><span class="n">dimensionless</span><span class="p">]</span>
    <span class="n">Overall</span> <span class="n">scaling</span><span class="o">/</span><span class="n">normalisation</span> <span class="n">of</span> <span class="n">template</span>
</pre></div>
</div>
</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.aeff.weight.weight.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/weight.html#weight.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.weight.weight.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.aeff.weight_hnl">
<span id="pisa-stages-aeff-weight-hnl-module"></span><h2>pisa.stages.aeff.weight_hnl module<a class="headerlink" href="#module-pisa.stages.aeff.weight_hnl" title="Link to this heading"></a></h2>
<p>PISA pi stage to apply HNL specific re-weighting</p>
<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.aeff.weight_hnl.re_weight_hnl">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.aeff.weight_hnl.</span></span><span class="sig-name descname"><span class="pre">re_weight_hnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">U_tau4_sq</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mass</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">energy</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tau</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_min</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_max</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hnl_decay_width</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">c=&lt;Quantity(2.99792458e+08</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">'meter</span> <span class="pre">/</span> <span class="pre">second')&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hbar=&lt;Quantity(6.58211957e-25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">'gigaelectron_volt</span> <span class="pre">*</span> <span class="pre">second')&gt;</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/weight_hnl.html#re_weight_hnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.weight_hnl.re_weight_hnl" title="Link to this definition"></a></dt>
<dd><p>Function to re-weight HNL events (from sampling 1/L to target exponential)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>U_tau4_sq</strong> (<em>float</em>) – Square of the HNL mixing angle</p></li>
<li><p><strong>mass</strong> (<em>float</em>) – HNL mass in GeV</p></li>
<li><p><strong>energy</strong> (<em>float</em>) – HNL energy in GeV</p></li>
<li><p><strong>tau</strong> (<em>float</em>) – HNL proper lifetime in ns</p></li>
<li><p><strong>distance_min</strong> (<em>float</em>) – Minimum sampling distance of HNL decay in m</p></li>
<li><p><strong>distance_max</strong> (<em>float</em>) – Maximum sampling distance of HNL decay in m</p></li>
<li><p><strong>hnl_decay_width</strong> (<em>float</em>) – HNL decay width in GeV</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>weight_lifetime</strong> – Weight to re-weight HNL events</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.aeff.weight_hnl.weight_hnl">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.aeff.weight_hnl.</span></span><span class="sig-name descname"><span class="pre">weight_hnl</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/weight_hnl.html#weight_hnl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.weight_hnl.weight_hnl" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>PISA pi stage to apply HNL specific re-weighting.</p>
<p>This re-weights HNL events from sampling 1/L to target exponential and applies .</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>params</strong> – <dl class="simple">
<dt>Expected params are .. ::</dt><dd><p>U_tau4_sq : dimensionless Quantity</p>
</dd>
</dl>
</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.aeff.weight_hnl.weight_hnl.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/aeff/weight_hnl.html#weight_hnl.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.aeff.weight_hnl.weight_hnl.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.aeff">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pisa.stages.aeff" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pisa.stages.absorption.html" class="btn btn-neutral float-left" title="pisa.stages.absorption package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pisa.stages.background.html" class="btn btn-neutral float-right" title="pisa.stages.background package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The IceCube/PINGU Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>