<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pisa.utils.flavInt &mdash; PISA 4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=9f5556dd"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            PISA
          </a>
              <div class="version">
                4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">API reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PISA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pisa.utils.flavInt</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pisa.utils.flavInt</h1><div class="highlight"><pre>
<span></span><span class="ch">#! /usr/bin/env python</span>
<span class="c1"># pylint: disable=global-statement</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes for working with neutrino flavors (NuFlav), interactions types</span>
<span class="sd">(IntType), &quot;flavints&quot; (a flavor and an interaction type) (NuFlavInt), and</span>
<span class="sd">flavint groups (NuFlavIntGroup) in a consistent and convenient manner.</span>

<span class="sd">FlavIntData class for working with data stored by flavint (flavor &amp;</span>
<span class="sd">interaction type). This should replace the PISA convention of using raw</span>
<span class="sd">doubly-nested dictionaries indexed as [&lt;flavor&gt;][&lt;interaction type&gt;]. For</span>
<span class="sd">now, FlavIntData objects can be drop-in replacements for such dictionaries</span>
<span class="sd">(they can be accessed and written to in the same way since FlavIntData</span>
<span class="sd">subclasses dict) but this should be deprecated; eventually, all direct access</span>
<span class="sd">of the data structure should be eliminated and disallowed by the FlavIntData</span>
<span class="sd">object.</span>

<span class="sd">Define convenience tuples ALL_{x} for easy iteration</span>
<span class="sd">&quot;&quot;&quot;</span>


<span class="c1"># TODO: Make strings convertible to various types less liberal. E.g., I already</span>
<span class="c1"># converted NuFlav to NOT accept &#39;numucc&#39; such that things like &#39;numu nue&#39; or</span>
<span class="c1"># &#39;nu xyz mutation&#39; would also be rejected; this should be true also for</span>
<span class="c1"># interaction type and possibly others I haven&#39;t thought about yet. Note that I</span>
<span class="c1"># achieved this using the IGNORE regex that ignores all non-alpha characters</span>
<span class="c1"># but asserts one and only one match to the regex (consult NuFlav for details).</span>

<span class="c1"># TODO: make simple_str() method convertible back to NuFlavIntGroup, either by</span>
<span class="c1"># increasing the intelligence of interpret(), by modifying what simple_str()</span>
<span class="c1"># produces, or by adding another function to interpret simple strings. (I&#39;m</span>
<span class="c1"># leaning towards the second option at the moment, since I don&#39;t see how to</span>
<span class="c1"># make the first interpret both a simple_str AND nue as nuecc+nuenc, and I</span>
<span class="c1"># don&#39;t think there&#39;s a way to know &quot;this is a simple str&quot; vs not easily.)</span>


<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">division</span>

<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">MutableSequence</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">,</span> <span class="n">Mapping</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">reduce</span><span class="p">,</span> <span class="n">total_ordering</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span><span class="p">,</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">operator</span> <span class="kn">import</span> <span class="n">add</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">pisa</span> <span class="kn">import</span> <span class="n">ureg</span>
<span class="kn">from</span> <span class="nn">pisa.utils</span> <span class="kn">import</span> <span class="n">fileio</span>
<span class="kn">from</span> <span class="nn">pisa.utils.log</span> <span class="kn">import</span> <span class="n">logging</span><span class="p">,</span> <span class="n">set_verbosity</span>
<span class="kn">from</span> <span class="nn">pisa.utils.comparisons</span> <span class="kn">import</span> <span class="n">recursiveAllclose</span><span class="p">,</span> <span class="n">recursiveEquality</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;NuFlav&#39;</span><span class="p">,</span> <span class="s1">&#39;NuFlavInt&#39;</span><span class="p">,</span> <span class="s1">&#39;NuFlavIntGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;FlavIntData&#39;</span><span class="p">,</span>
    <span class="s1">&#39;FlavIntDataGroup&#39;</span><span class="p">,</span> <span class="s1">&#39;xlateGroupsStr&#39;</span><span class="p">,</span>
    <span class="s1">&#39;flavintGroupsFromString&#39;</span><span class="p">,</span> <span class="s1">&#39;IntType&#39;</span><span class="p">,</span> <span class="s1">&#39;BarSep&#39;</span><span class="p">,</span> <span class="s1">&#39;set_bar_ssep&#39;</span><span class="p">,</span>
    <span class="s1">&#39;get_bar_ssep&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL_NUPARTICLES&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL_NUANTIPARTICLES&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ALL_NUFLAVS&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL_NUINT_TYPES&#39;</span><span class="p">,</span> <span class="s1">&#39;CC&#39;</span><span class="p">,</span> <span class="s1">&#39;NC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NUE&#39;</span><span class="p">,</span> <span class="s1">&#39;NUEBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMU&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMUBAR&#39;</span><span class="p">,</span> <span class="s1">&#39;NUTAU&#39;</span><span class="p">,</span> <span class="s1">&#39;NUTAUBAR&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ALL_NUFLAVINTS&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL_NUCC&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL_NUNC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NUECC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUEBARCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMUCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMUBARCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUTAUCC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUTAUBARCC&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NUENC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUEBARNC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMUNC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUMUBARNC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUTAUNC&#39;</span><span class="p">,</span> <span class="s1">&#39;NUTAUBARNC&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;J.L. Lanfranchi&#39;</span>

<span class="n">__license__</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Copyright (c) 2014-2017, The IceCube Collaboration</span>

<span class="s1"> Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="s1"> you may not use this file except in compliance with the License.</span>
<span class="s1"> You may obtain a copy of the License at</span>

<span class="s1">   http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="s1"> Unless required by applicable law or agreed to in writing, software</span>
<span class="s1"> distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="s1"> WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="s1"> See the License for the specific language governing permissions and</span>
<span class="s1"> limitations under the License.&#39;&#39;&#39;</span>

<span class="n">__BAR_SSEP__</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>


<div class="viewcode-block" id="BarSep">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.BarSep">[docs]</a>
<span class="k">class</span> <span class="nc">BarSep</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Context manager to make global __BAR_SSEP__ modification slightly less</span>
<span class="sd">    error-prone.</span>

<span class="sd">    __BAR_SSEP__ defines the separator between a flavor and the string &quot;bar&quot;</span>
<span class="sd">    (to define the flavor as the antiparticle version; e.g. nuebar). Some</span>
<span class="sd">    datastructures in PISA 2 used &#39;_&#39; between the two (&quot;nue_bar&quot;) while others</span>
<span class="sd">    did not use this. To make dealing with this (slightly) less painful, this</span>
<span class="sd">    context manager was introduced to switch between the PISA 3 default (no</span>
<span class="sd">    &#39;_&#39;) and the sometimes-use &#39;_&#39; separator. See Examples for usage.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val : string</span>
<span class="sd">        Separator to use between flavor (&quot;nue&quot;, &quot;numu&quot;, &quot;nutau&quot;) and &quot;bar&quot;.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; nuebar = NuFlav(&#39;nuebar&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print(str(nuebar))</span>
<span class="sd">    nuebar</span>
<span class="sd">    &gt;&gt;&gt; with BarSep(&#39;_&#39;):</span>
<span class="sd">    ...     print(nuebar)</span>
<span class="sd">    nue_bar</span>
<span class="sd">    &gt;&gt;&gt; print(str(nuebar))</span>
<span class="sd">    nuebar</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">__BAR_SSEP__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">old_val</span> <span class="o">=</span> <span class="n">__BAR_SSEP__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_val</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">__BAR_SSEP__</span>
        <span class="n">__BAR_SSEP__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new_val</span>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">__BAR_SSEP__</span>
        <span class="n">__BAR_SSEP__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">old_val</span></div>



<div class="viewcode-block" id="set_bar_ssep">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.set_bar_ssep">[docs]</a>
<span class="k">def</span> <span class="nf">set_bar_ssep</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the separator between &quot;base&quot; flavor (&quot;nue&quot;, &quot;numu&quot;, or &quot;nutau&quot;) and</span>
<span class="sd">    &quot;bar&quot; when converting antineutrino `NuFlav`s or `NuFlavInt`s to strings.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val : string</span>
<span class="sd">        Separator</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">__BAR_SSEP__</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
    <span class="n">__BAR_SSEP__</span> <span class="o">=</span> <span class="n">val</span></div>



<div class="viewcode-block" id="get_bar_ssep">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.get_bar_ssep">[docs]</a>
<span class="k">def</span> <span class="nf">get_bar_ssep</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the separator that is set to be used between &quot;base&quot; flavor (&quot;nue&quot;,</span>
<span class="sd">    &quot;numu&quot;, or &quot;nutau&quot;) and &quot;bar&quot; when converting antineutrino `NuFlav`s or</span>
<span class="sd">    `NuFlavInt`s to strings.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    sep : string</span>
<span class="sd">        Separator</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">__BAR_SSEP__</span>
    <span class="k">return</span> <span class="n">__BAR_SSEP__</span></div>



<div class="viewcode-block" id="NuFlav">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlav">[docs]</a>
<span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">NuFlav</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for handling neutrino flavors (and anti-flavors)&quot;&quot;&quot;</span>
    <span class="n">PART_CODE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ANTIPART_CODE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">NUE_CODE</span> <span class="o">=</span> <span class="mi">12</span>
    <span class="n">NUMU_CODE</span> <span class="o">=</span> <span class="mi">14</span>
    <span class="n">NUTAU_CODE</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">NUEBAR_CODE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">12</span>
    <span class="n">NUMUBAR_CODE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">14</span>
    <span class="n">NUTAUBAR_CODE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">16</span>
    <span class="n">IGNORE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z]&#39;</span><span class="p">)</span>
    <span class="n">FLAV_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;^(?P&lt;fullflav&gt;(?:nue|numu|nutau)(?P&lt;barnobar&gt;bar){0,1})$&#39;</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fstr2code</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;nue&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUE_CODE</span><span class="p">,</span>
            <span class="s1">&#39;numu&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMU_CODE</span><span class="p">,</span>
            <span class="s1">&#39;nutau&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUTAU_CODE</span><span class="p">,</span>
            <span class="s1">&#39;nuebar&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUEBAR_CODE</span><span class="p">,</span>
            <span class="s1">&#39;numubar&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMUBAR_CODE</span><span class="p">,</span>
            <span class="s1">&#39;nutaubar&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUTAUBAR_CODE</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">barnobar2code</span> <span class="o">=</span> <span class="p">{</span>
            <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PART_CODE</span><span class="p">,</span>
            <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">PART_CODE</span><span class="p">,</span>
            <span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANTIPART_CODE</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2tex</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NUE_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\nu_e}&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NUMU_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\nu_\mu}&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NUTAU_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\nu_\tau}&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NUEBAR_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\bar\nu_e}&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NUMUBAR_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\bar\nu_\mu}&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NUTAUBAR_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\bar\nu_\tau}&#39;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="c1"># Instantiate this neutrino flavor object by interpreting val</span>
        <span class="n">orig_val</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Sanitize the string</span>
                <span class="n">sanitized_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IGNORE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FLAV_RE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">sanitized_val</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">matches</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid NuFlav spec: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fstr2code</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">barnobar2code</span><span class="p">[</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">code</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;flav&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fstr2code</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid neutrino flavor/code: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span>
                                     <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="c1"># Double check than flav and barnobar codes are valid</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fstr2code</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">barnobar2code</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret `val` = &quot;</span><span class="si">%s</span><span class="s1">&quot; as </span><span class="si">%s</span><span class="s1">.&#39;</span>
                             <span class="s1">&#39; type(val) = </span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">orig_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                <span class="nb">type</span><span class="p">(</span><span class="n">orig_val</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">global</span> <span class="n">__BAR_SSEP__</span>
        <span class="n">fstr</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fstr2code</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">]</span>
        <span class="n">fstr</span> <span class="o">=</span> <span class="n">fstr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fstr</span> <span class="o">=</span> <span class="n">fstr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">__BAR_SSEP__</span><span class="o">+</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fstr</span>

    <span class="c1"># TODO: copy, deepcopy, and JSON serialization</span>
    <span class="c1">#def __copy__(self):</span>
    <span class="c1">#    return self.__str__()</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot compare </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="n">my_abs_code</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="n">other_abs_code</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>

        <span class="c1"># A particle comes before its own antiparticle</span>
        <span class="k">if</span> <span class="n">other_abs_code</span> <span class="o">==</span> <span class="n">my_abs_code</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">code</span>

        <span class="c1"># nue or nuebar &lt; numu or numubar &lt; nutau or nutaubar</span>
        <span class="k">return</span> <span class="n">my_abs_code</span> <span class="o">&lt;</span> <span class="n">other_abs_code</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NuFlav</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TeX string&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">f2tex</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;int : PDG code&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">bar_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return +/-1 for particle/antiparticle&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">particle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this a particle (vs. antiparticle) flavor?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">PART_CODE</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">antiparticle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this an antiparticle flavor?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__barnobar</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ANTIPART_CODE</span>

<div class="viewcode-block" id="NuFlav.pidx">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlav.pidx">[docs]</a>
    <span class="k">def</span> <span class="nf">pidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract data from a nested dictionary `d` whose format is commonly</span>
<span class="sd">        found in PISA</span>

<span class="sd">        The dictionary must have the format</span>
<span class="sd">            d = {&quot;&lt;flavor&gt;&quot;: &lt;data object&gt;}</span>
<span class="sd">            &lt;flavor&gt; is one of &quot;nue&quot;, &quot;nue_bar&quot;, &quot;numu&quot;, &quot;numu_bar&quot;, &quot;nutau&quot;,</span>
<span class="sd">                &quot;nutau_bar&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">BarSep</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">field</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">prob3_codes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;(int,int) : flavor and particle/antiparticle codes, as used by prob3&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUE_CODE</span> <span class="p">:</span> <span class="n">prob3flav</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUMU_CODE</span> <span class="p">:</span> <span class="n">prob3flav</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUTAU_CODE</span> <span class="p">:</span> <span class="n">prob3flav</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">prob3bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bar_code</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">prob3flav</span><span class="p">,</span><span class="n">prob3bar</span><span class="p">)</span></div>



<span class="n">NUE</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nue&#39;</span><span class="p">)</span>
<span class="n">NUEBAR</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nuebar&#39;</span><span class="p">)</span>
<span class="n">NUMU</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)</span>
<span class="n">NUMUBAR</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numubar&#39;</span><span class="p">)</span>
<span class="n">NUTAU</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nutau&#39;</span><span class="p">)</span>
<span class="n">NUTAUBAR</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nutaubar&#39;</span><span class="p">)</span>

<span class="n">ALL_NUPARTICLES</span> <span class="o">=</span> <span class="p">(</span><span class="n">NUE</span><span class="p">,</span> <span class="n">NUMU</span><span class="p">,</span> <span class="n">NUTAU</span><span class="p">)</span>
<span class="n">ALL_NUANTIPARTICLES</span> <span class="o">=</span> <span class="p">(</span><span class="n">NUEBAR</span><span class="p">,</span> <span class="n">NUMUBAR</span><span class="p">,</span> <span class="n">NUTAUBAR</span><span class="p">)</span>
<span class="n">ALL_NUFLAVS</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">ALL_NUPARTICLES</span> <span class="o">+</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">))</span>


<span class="c1"># TODO: are the following two classes redundant now?</span>
<span class="k">class</span> <span class="nc">AllNu</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ALL_NUPARTICLES</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flav</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;nuall&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;{\nu_{\rm all}}&#39;</span>


<span class="k">class</span> <span class="nc">AllNuBar</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flav</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;nuallbar&#39;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">r</span><span class="s1">&#39;{\bar\nu_{\rm all}}&#39;</span>


<div class="viewcode-block" id="IntType">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.IntType">[docs]</a>
<span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">IntType</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interaction type object.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val</span>
<span class="sd">        See Notes.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Instantiate via a `val` of:</span>
<span class="sd">      * Numerical code: 1=CC, 2=NC</span>
<span class="sd">      * String (case-insensitive; all characters besides valid tokens are</span>
<span class="sd">        ignored)</span>
<span class="sd">      * Instantiated IntType object (or any method implementing int_type.code</span>
<span class="sd">        which returns a valid interaction type code)</span>
<span class="sd">      * Instantiated NuFlavInt object (or any object implementing int_type</span>
<span class="sd">        which returns a valid IntType object)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    The following, e.g., are all interpreted as charged-current IntTypes:</span>

<span class="sd">    &gt;&gt;&gt; IntType(&#39;cc&#39;)</span>
<span class="sd">    &gt;&gt;&gt; IntType(&#39;\n\t _cc \n&#39;)</span>
<span class="sd">    &gt;&gt;&gt; IntType(&#39;numubarcc&#39;)</span>
<span class="sd">    &gt;&gt;&gt; IntType(1)</span>
<span class="sd">    &gt;&gt;&gt; IntType(1.0)</span>
<span class="sd">    &gt;&gt;&gt; IntType(IntType(&#39;cc&#39;))</span>
<span class="sd">    &gt;&gt;&gt; IntType(NuFlavInt(&#39;numubarcc&#39;))</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">CC_CODE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">NC_CODE</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">IGNORE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z]&#39;</span><span class="p">)</span>
    <span class="n">IT_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(cc|nc)$&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">istr2code</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">CC_CODE</span><span class="p">,</span>
            <span class="s1">&#39;nc&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">NC_CODE</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">i2tex</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">CC_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm CC}&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NC_CODE</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;{\rm NC}&#39;</span>
        <span class="p">}</span>

        <span class="c1"># Interpret `val`</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">orig_val</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">sanitized_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IGNORE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="n">int_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IT_RE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">sanitized_val</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">int_type</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid IntType spec: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">val</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">istr2code</span><span class="p">[</span><span class="n">int_type</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">code</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;int_type&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">int_type</span><span class="p">,</span> <span class="s1">&#39;code&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">istr2code</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s1">&#39;`val` = &quot;</span><span class="si">%s</span><span class="s1">&quot; could not be converted to an </span><span class="si">%s</span><span class="s1">;&#39;</span>
                        <span class="s1">&#39; type(val) = </span><span class="si">%s</span><span class="s1">&#39;</span>
                        <span class="o">%</span> <span class="p">(</span><span class="n">orig_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">orig_val</span><span class="p">))</span>
                    <span class="p">)</span>
            <span class="c1"># Double check that the interaction type code set is valid</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">istr2code</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret `val` = &quot;</span><span class="si">%s</span><span class="s1">&quot; as </span><span class="si">%s</span><span class="s1">;&#39;</span>
                             <span class="s1">&#39; type(val) = </span><span class="si">%s</span><span class="s1">&#39;</span>
                             <span class="o">%</span> <span class="p">(</span><span class="n">orig_val</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                <span class="nb">type</span><span class="p">(</span><span class="n">orig_val</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">code</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">istr2code</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">code</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">cc</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cc</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot compare </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">code</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this interaction type charged current (CC)?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">CC_CODE</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this interaction type neutral current (NC)?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NC_CODE</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Integer code for this interaction type&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TeX representation of this interaction type&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">i2tex</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span><span class="p">]</span></div>



<span class="n">CC</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="s1">&#39;cc&#39;</span><span class="p">)</span>
<span class="n">NC</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="s1">&#39;nc&#39;</span><span class="p">)</span>
<span class="n">ALL_NUINT_TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="n">CC</span><span class="p">,</span> <span class="n">NC</span><span class="p">)</span>


<div class="viewcode-block" id="NuFlavInt">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavInt">[docs]</a>
<span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">NuFlavInt</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A neutrino &quot;flavint&quot; encompasses both the neutrino flavor and its</span>
<span class="sd">    interaction type.</span>

<span class="sd">    Instantiate via</span>
<span class="sd">      * String containing a single flavor and a single interaction type</span>
<span class="sd">        e.g.: &#39;numucc&#39;, &#39;nu_mu_cc&#39;, &#39;nu mu CC&#39;, &#39;numu_bar CC&#39;, etc.</span>
<span class="sd">      * Another instantiated NuFlavInt object</span>
<span class="sd">      * Two separate objects that can be converted to a valid NuFlav</span>
<span class="sd">        and a valid IntType (in that order)</span>
<span class="sd">      * An iterable of length two which contains such objects</span>
<span class="sd">      * kwargs `flav` and `int_type` specifying such objects</span>

<span class="sd">    String specifications simply ignore all characters not recognized as a</span>
<span class="sd">    valid token.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TOKENS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(nu|e|mu|tau|bar|nc|cc)&#39;</span><span class="p">)</span>
    <span class="n">FINT_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;(?P&lt;fullflav&gt;(?:nue|numu|nutau)&#39;</span>
        <span class="sa">r</span><span class="s1">&#39;(?P&lt;barnobar&gt;bar){0,1})&#39;</span>
        <span class="sa">r</span><span class="s1">&#39;(?P&lt;int_type&gt;cc|nc){0,1}&#39;</span>
    <span class="p">)</span>
    <span class="n">FINT_SSEP</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span>
    <span class="n">FINT_TEXSEP</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39; \, &#39;</span>
    <span class="c1"># TODO: use multiple inheritance to clean up the below?</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Either positional or keyword args may be&#39;</span>
                                <span class="s1">&#39; provided, but not both&#39;</span><span class="p">)</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">((</span><span class="s1">&#39;flav&#39;</span><span class="p">,</span> <span class="s1">&#39;int_type&#39;</span><span class="p">))):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Invalid kwarg(s) specified: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">flavint</span> <span class="o">=</span> <span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;flav&#39;</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;int_type&#39;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;No flavint specification provided&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">flavint</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">flavint</span> <span class="o">=</span> <span class="n">args</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;More than two args&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flavint</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">flavint</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">flavint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flavint</span> <span class="o">=</span> <span class="n">flavint</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flavint</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">orig_flavint</span> <span class="o">=</span> <span class="n">flavint</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">flavint</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TOKENS</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">flavint</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
                <span class="n">flavint_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FINT_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">flavint</span><span class="p">)</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">flavint_dict</span><span class="p">[</span><span class="s1">&#39;fullflav&#39;</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="n">flavint_dict</span><span class="p">[</span><span class="s1">&#39;int_type&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">UnboundLocalError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret `val` = &quot;</span><span class="si">%s</span><span class="s1">&quot; as </span><span class="si">%s</span><span class="s1">;&#39;</span>
                                 <span class="s1">&#39; type(val) = </span><span class="si">%s</span><span class="s1">&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">orig_flavint</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                    <span class="nb">type</span><span class="p">(</span><span class="n">orig_flavint</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flavint</span><span class="p">,</span> <span class="n">NuFlavInt</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">flavint</span><span class="o">.</span><span class="n">flav</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="n">flavint</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">flavint</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">flavint</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> \
                    <span class="s1">&#39;Need 2 components to define flavor and interaction type&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">flavint</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="n">flavint</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unhandled type: &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">flavint</span><span class="p">))</span> <span class="o">+</span>
                            <span class="s1">&#39;&quot;; class: &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">flavint</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="o">+</span>
                            <span class="s1">&#39;; value: &quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">flavint</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s%s%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">FINT_SSEP</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flav</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">int_type</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">other</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot compare </span><span class="si">%s</span><span class="s1"> to </span><span class="si">%s</span><span class="s1">.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">code</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span> <span class="o">&gt;</span> <span class="n">other</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">code</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

<div class="viewcode-block" id="NuFlavInt.pidx">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavInt.pidx">[docs]</a>
    <span class="k">def</span> <span class="nf">pidx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract data from a nested dictionary `d` whose format is commonly</span>
<span class="sd">        found in PISA</span>

<span class="sd">        The dictionary must have the format::</span>

<span class="sd">            d = {&quot;&lt;flavor&gt;&quot;: {&quot;&lt;interaction type&gt;&quot;: &lt;data object&gt;}}</span>
<span class="sd">            &lt;flavor&gt; is one of &quot;nue&quot;, &quot;nue_bar&quot;, &quot;numu&quot;, &quot;numu_bar&quot;, &quot;nutau&quot;,</span>
<span class="sd">                &quot;nutau_bar&quot;</span>
<span class="sd">            &lt;interaction type&gt; is one of &quot;cc&quot;, &quot;nc&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">with</span> <span class="n">BarSep</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="p">)][</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">field</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flav</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return just the NuFlav part of this NuFlavInt&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">particle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this a particle (vs. antiparticle) flavor?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="o">.</span><span class="n">particle</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">antiparticle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this an antiparticle flavor?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flav</span><span class="o">.</span><span class="n">antiparticle</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this interaction type charged current (CC)?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span><span class="o">.</span><span class="n">cc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># pylint: disable=invalid-name</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is this interaction type neutral current (NC)?&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span><span class="o">.</span><span class="n">nc</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">int_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return IntType object that composes this NuFlavInt&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__int_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TeX string representation of this NuFlavInt&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39;{</span><span class="si">%s%s%s</span><span class="s1">}&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flav</span><span class="o">.</span><span class="n">tex</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">FINT_TEXSEP</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">int_type</span><span class="o">.</span><span class="n">tex</span><span class="p">)</span></div>



<span class="n">NUECC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuecc&#39;</span><span class="p">)</span>
<span class="n">NUEBARCC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuebarcc&#39;</span><span class="p">)</span>
<span class="n">NUMUCC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numucc&#39;</span><span class="p">)</span>
<span class="n">NUMUBARCC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numubarcc&#39;</span><span class="p">)</span>
<span class="n">NUTAUCC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutaucc&#39;</span><span class="p">)</span>
<span class="n">NUTAUBARCC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutaubarcc&#39;</span><span class="p">)</span>

<span class="n">NUENC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuenc&#39;</span><span class="p">)</span>
<span class="n">NUEBARNC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuebarnc&#39;</span><span class="p">)</span>
<span class="n">NUMUNC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numunc&#39;</span><span class="p">)</span>
<span class="n">NUMUBARNC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numubarnc&#39;</span><span class="p">)</span>
<span class="n">NUTAUNC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutaunc&#39;</span><span class="p">)</span>
<span class="n">NUTAUBARNC</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutaubarnc&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="NuFlavIntGroup">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup">[docs]</a>
<span class="nd">@total_ordering</span>
<span class="k">class</span> <span class="nc">NuFlavIntGroup</span><span class="p">(</span><span class="n">MutableSequence</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Grouping of neutrino flavors+interaction types (flavints)</span>

<span class="sd">    Grouping of neutrino flavints. Specification can be via</span>
<span class="sd">      * A single `NuFlav` object; this gets promoted to include both</span>
<span class="sd">        interaction types</span>
<span class="sd">      * A single `NuFlavInt` object</span>
<span class="sd">      * String:</span>
<span class="sd">        * Ignores anything besides valid tokens</span>
<span class="sd">        * A flavor with no interaction type specified will include both CC</span>
<span class="sd">          and NC interaction types</span>
<span class="sd">        * Multiple flavor/interaction-type specifications can be made;</span>
<span class="sd">          use of delimiters is optional</span>
<span class="sd">        * Interprets &quot;nuall&quot; as nue+numu+nutau and &quot;nuallbar&quot; as</span>
<span class="sd">          nuebar+numubar+nutaubar</span>
<span class="sd">      * Iterable containing any of the above (i.e., objects convertible to</span>
<span class="sd">        `NuFlavInt` objects). Note that a valid iterable is another</span>
<span class="sd">        `NuFlavIntGroup` object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TOKENS</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;(nu|e|mu|tau|all|bar|nc|cc)&#39;</span><span class="p">)</span>
    <span class="n">IGNORE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^a-zA-Z]&#39;</span><span class="p">)</span>
    <span class="n">FLAVINT_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
        <span class="sa">r</span><span class="s1">&#39;((?:nue|numu|nutau|nuall)(?:bar){0,1}(?:cc|nc){0,2})&#39;</span>
    <span class="p">)</span>
    <span class="n">FLAV_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;fullflav&gt;(?:nue|numu|nutau|nuall)(?:bar){0,1})&#39;</span><span class="p">)</span>
    <span class="n">IT_RE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(cc|nc)&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flavint_ssep</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Possibly a special case if len(args) == 2, so send as a single entity</span>
        <span class="c1"># if this is the case</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">args</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
            <span class="bp">self</span> <span class="o">+=</span> <span class="n">a</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">flavint_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">flavint_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

<div class="viewcode-block" id="NuFlavIntGroup.remove">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.remove">[docs]</a>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a flavint from this group.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : anything accepted by `interpret` method</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flavint_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">value</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">flavint_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">cp</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cp</span>

    <span class="k">def</span> <span class="fm">__isub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

<div class="viewcode-block" id="NuFlavIntGroup.insert">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.insert">[docs]</a>
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert flavint `value` before `index`&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot compare </span><span class="si">%s</span><span class="s1"> with </span><span class="si">%s</span><span class="s1">.&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavints</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">flavints</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">all</span><span class="p">([(</span><span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">val</span><span class="p">)])</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">allkg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span>

        <span class="c1"># Check if nuall or nuallbar CC, NC, or both</span>
        <span class="n">nuallcc</span><span class="p">,</span> <span class="n">nuallbarcc</span><span class="p">,</span> <span class="n">nuallnc</span><span class="p">,</span> <span class="n">nuallbarnc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
        <span class="n">cc_flavints</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cc_flavints</span><span class="p">)</span>
        <span class="n">nc_flavints</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nc_flavints</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cc_flavints</span><span class="o">.</span><span class="n">particles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nuallcc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cc_flavints</span><span class="o">.</span><span class="n">antiparticles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nuallbarcc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_flavints</span><span class="o">.</span><span class="n">particles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nuallnc</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nc_flavints</span><span class="o">.</span><span class="n">antiparticles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">nuallbarnc</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Construct nuall(bar) part(s) of string</span>
        <span class="n">strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nuallcc</span> <span class="ow">and</span> <span class="n">nuallnc</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuall&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">nuallcc</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuall&#39;</span> <span class="o">+</span> <span class="n">NuFlavInt</span><span class="o">.</span><span class="n">FINT_SSEP</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CC</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">nuallnc</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuall&#39;</span> <span class="o">+</span> <span class="n">NuFlavInt</span><span class="o">.</span><span class="n">FINT_SSEP</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NC</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">nuallbarcc</span> <span class="ow">and</span> <span class="n">nuallbarnc</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuallbar&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">nuallbarcc</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuallbar&#39;</span> <span class="o">+</span> <span class="n">NuFlavInt</span><span class="o">.</span><span class="n">FINT_SSEP</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">CC</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">nuallbarnc</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;nuallbar&#39;</span> <span class="o">+</span> <span class="n">NuFlavInt</span><span class="o">.</span><span class="n">FINT_SSEP</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">NC</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">:</span>
                <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))</span>

        <span class="c1"># Among remaining flavints, group by flavor and combine if both CC and</span>
        <span class="c1"># NC are present for individual flavors (i.e., eliminate the int_type</span>
        <span class="c1"># string altogether)</span>
        <span class="k">for</span> <span class="n">flav</span> <span class="ow">in</span> <span class="n">ALL_NUPARTICLES</span> <span class="o">+</span> <span class="n">ALL_NUANTIPARTICLES</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">flav</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">flav</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">allkg</span><span class="p">]:</span>
                <span class="n">cc</span><span class="p">,</span> <span class="n">nc</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allkg</span><span class="p">:</span>
                    <span class="n">cc</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">allkg</span><span class="p">:</span>
                    <span class="n">nc</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">cc</span> <span class="ow">and</span> <span class="n">nc</span><span class="p">:</span>
                    <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">flav</span><span class="p">))</span>
                    <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">))</span>
                    <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">cc</span><span class="p">:</span>
                    <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">)))</span>
                    <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">nc</span><span class="p">:</span>
                    <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">)))</span>
                    <span class="n">allkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavint_ssep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="c1"># TODO:</span>
    <span class="c1"># Technically, since this is a mutable type, the __hash__ method shouldn&#39;t</span>
    <span class="c1"># be implemented as this will allow for &quot;illegal&quot; behavior, like using</span>
    <span class="c1"># a NuFlavIntGroup as a key in a dict. So this should be fixed, maybe.</span>
    <span class="c1">#__hash__ = None</span>
    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">))</span>

<div class="viewcode-block" id="NuFlavIntGroup.interpret">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.interpret">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">interpret</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Interpret a NuFlavIntGroup arg&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">orig_val</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">flavints</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">orig_val</span> <span class="o">=</span> <span class="n">val</span>

                <span class="c1"># Eliminate anything besides valid tokens</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">IGNORE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="c1">#val = &#39;&#39;.join(NuFlavIntGroup.TOKENS.findall(val))</span>

                <span class="c1"># Find all flavints specified</span>
                <span class="n">allflavints_str</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">FLAVINT_RE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="c1"># Remove flavints</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">FLAVINT_RE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">flavint_str</span> <span class="ow">in</span> <span class="n">allflavints_str</span><span class="p">:</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">FLAV_RE</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">flavint_str</span><span class="p">)</span>
                    <span class="n">flav</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()[</span><span class="s1">&#39;fullflav&#39;</span><span class="p">]</span>

                    <span class="c1"># A flavint found above can include &#39;all&#39; which is actually</span>
                    <span class="c1"># three different flavors</span>
                    <span class="k">if</span> <span class="s1">&#39;all&#39;</span> <span class="ow">in</span> <span class="n">flav</span><span class="p">:</span>
                        <span class="n">flavs</span> <span class="o">=</span> <span class="p">[</span><span class="n">flav</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                                 <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">)]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">flavs</span> <span class="o">=</span> <span class="p">[</span><span class="n">flav</span><span class="p">]</span>

                    <span class="n">ints</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span>
                        <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">IT_RE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">flavint_str</span><span class="p">)</span>
                    <span class="p">))</span>

                    <span class="c1"># If flavint_str does not include &#39;cc&#39; or &#39;nc&#39;, include both</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">ints</span><span class="p">:</span>
                        <span class="n">ints</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">]</span>

                    <span class="c1"># Add all combinations of (flav, int) found in this</span>
                    <span class="c1"># flavint_str</span>
                    <span class="n">flavints</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">flavs</span><span class="p">,</span> <span class="n">ints</span><span class="p">)])</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Could not interpret `val` = &quot;</span><span class="si">%s</span><span class="s1">&quot; as </span><span class="si">%s</span><span class="s1">;&#39;</span>
                                 <span class="s1">&#39; type(val) = </span><span class="si">%s</span><span class="s1">&#39;</span>
                                 <span class="o">%</span> <span class="p">(</span><span class="n">orig_val</span><span class="p">,</span> <span class="n">NuFlavIntGroup</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">orig_val</span><span class="p">)))</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NuFlav</span><span class="p">):</span>
            <span class="n">flavints</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavInt</span><span class="p">((</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">)),</span> <span class="n">NuFlavInt</span><span class="p">((</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">))]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NuFlavInt</span><span class="p">):</span>
            <span class="n">flavints</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">NuFlavIntGroup</span><span class="p">):</span>
            <span class="n">flavints</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">flavints</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flavints</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
            <span class="n">flavints</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1"># Treat length-2 iterables as special case, in case the two</span>
            <span class="c1"># elements can form a single NuFlavInt.</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">try_again</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># Start with counter-hypothesis: that the two elements of</span>
                    <span class="c1"># `val` can form two valid, independent NuFlavInts...</span>
                    <span class="n">k1</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">k2</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">k1</span> <span class="ow">and</span> <span class="n">k2</span><span class="p">:</span>
                        <span class="c1"># Success: Two independent NuFlavInts were created</span>
                        <span class="n">try_again</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">flavints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>
                        <span class="n">flavints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">UnboundLocalError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">,</span>
                        <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">if</span> <span class="n">try_again</span><span class="p">:</span>
                    <span class="c1"># If the two elements of the iterable did not form two</span>
                    <span class="c1"># NuFlavInts, try forming a single NuFlavInt with `val`</span>
                    <span class="n">flavints</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">val</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If 1 or &gt;2 elements in `val`, make a flavint out of each</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">flavints</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="o">.</span><span class="n">interpret</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Unhandled val: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, class &#39;</span>
                            <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="o">.</span><span class="vm">__class__</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; type &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

        <span class="n">flavint_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">flavints</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nk</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">flavint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nk</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="c1"># If NuFlavInt failed, try NuFlav; if this fails, give up.</span>
                <span class="n">flav</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                <span class="n">flavint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">((</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">)))</span>
                <span class="n">flavint_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">((</span><span class="n">flav</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">flavint_list</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flavints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of all NuFlavInts that make up this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flavs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique flavors that make up this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">flav</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span><span class="p">])))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cc_flavints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique charged-current-interaction NuFlavInts that</span>
<span class="sd">        make up this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span>
                      <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">int_type</span> <span class="o">==</span> <span class="n">CC</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nc_flavints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique neutral-current-interaction NuFlavInts that</span>
<span class="sd">        make up this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span>
                      <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">int_type</span> <span class="o">==</span> <span class="n">NC</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">particles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique particle (vs antiparticle) NuFlavInts that</span>
<span class="sd">        make up this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">particle</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">antiparticles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique antiparticle NuFlavInts that make up this</span>
<span class="sd">        group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span> <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">antiparticle</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">cc_flavs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique charged-current-interaction flavors that</span>
<span class="sd">        make up this group. Note that only the flavors, and not NuFlavInts, are</span>
<span class="sd">        returned (cf. method `cc_flavints`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">flav</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span>
                                 <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">int_type</span> <span class="o">==</span> <span class="n">CC</span><span class="p">])))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">nc_flavs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return tuple of unique neutral-current-interaction flavors that</span>
<span class="sd">        make up this group. Note that only the flavors, and not NuFlavInts, are</span>
<span class="sd">        returned (cf. method `nc_flavints`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="n">k</span><span class="o">.</span><span class="n">flav</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__flavints</span>
                                 <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">int_type</span> <span class="o">==</span> <span class="n">NC</span><span class="p">])))</span>

    <span class="c1">#def unique_flavs(self):</span>
    <span class="c1">#    &quot;&quot;&quot;Return tuple of unique flavors that make up this group&quot;&quot;&quot;</span>
    <span class="c1">#    return tuple(sorted(set([k.flav for k in self.__flavints])))</span>

<div class="viewcode-block" id="NuFlavIntGroup.group_flavs_by_int_type">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.group_flavs_by_int_type">[docs]</a>
    <span class="k">def</span> <span class="nf">group_flavs_by_int_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a dictionary with flavors grouped by the interaction types</span>
<span class="sd">        represented in this group.</span>

<span class="sd">        The returned dictionary has format::</span>

<span class="sd">            {</span>
<span class="sd">                &#39;all_int_type_flavs&#39;: [&lt;NuFlav object&gt;, &lt;NuFlav object&gt;, ...],</span>
<span class="sd">                &#39;cc_only_flavs&#39;:      [&lt;NuFlav object&gt;, &lt;NuFlav object&gt;, ...],</span>
<span class="sd">                &#39;nc_only_flavs&#39;:      [&lt;NuFlav object&gt;, &lt;NuFlav object&gt;, ...],</span>
<span class="sd">            }</span>

<span class="sd">        where the lists of NuFlav objects are mutually exclusive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uniqueF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavs</span>
        <span class="n">fint_d</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">uniqueF</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavints</span><span class="p">:</span>
            <span class="n">fint_d</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">flav</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">int_type</span><span class="p">)</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;all_int_type_flavs&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;cc_only_flavs&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;nc_only_flavs&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">uniqueF</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fint_d</span><span class="p">[</span><span class="n">f</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;all_int_type_flavs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">list</span><span class="p">(</span><span class="n">fint_d</span><span class="p">[</span><span class="n">f</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">CC</span><span class="p">:</span>
                <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;cc_only_flavs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;nc_only_flavs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grouped</span></div>


    <span class="k">def</span> <span class="nf">__simple_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flavsep</span><span class="p">,</span> <span class="n">intsep</span><span class="p">,</span> <span class="n">flavintsep</span><span class="p">,</span> <span class="n">addsep</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_flavs_by_int_type</span><span class="p">()</span>
        <span class="n">all_nu</span> <span class="o">=</span> <span class="n">AllNu</span><span class="p">()</span>
        <span class="n">all_nubar</span> <span class="o">=</span> <span class="n">AllNuBar</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">f</span> <span class="ow">in</span> <span class="n">v</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_nubar</span><span class="o">.</span><span class="n">flav</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_nubar</span><span class="o">.</span><span class="n">flav</span><span class="p">:</span>
                    <span class="n">grouped</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">grouped</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">all_nubar</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">f</span> <span class="ow">in</span> <span class="n">v</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_nu</span><span class="o">.</span><span class="n">flav</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_nu</span><span class="o">.</span><span class="n">flav</span><span class="p">:</span>
                    <span class="n">grouped</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">grouped</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">all_nu</span><span class="p">)</span>
        <span class="n">all_s</span> <span class="o">=</span> <span class="n">flavsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;all_int_type_flavs&#39;</span><span class="p">]])</span>
        <span class="n">cc_only_s</span> <span class="o">=</span> <span class="n">flavsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;cc_only_flavs&#39;</span><span class="p">]])</span>
        <span class="n">nc_only_s</span> <span class="o">=</span> <span class="n">flavsep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">[</span><span class="s1">&#39;nc_only_flavs&#39;</span><span class="p">]])</span>
        <span class="n">strs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">all_s</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cc_only_s</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nc_only_s</span><span class="p">:</span>
                <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_s</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_s</span> <span class="o">+</span> <span class="n">intsep</span> <span class="o">+</span> <span class="n">func</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span> <span class="o">+</span> <span class="n">addsep</span> <span class="o">+</span> <span class="n">func</span><span class="p">(</span><span class="n">NC</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cc_only_s</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cc_only_s</span> <span class="o">+</span> <span class="n">intsep</span> <span class="o">+</span> <span class="n">func</span><span class="p">(</span><span class="n">CC</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">nc_only_s</span><span class="p">:</span>
            <span class="n">strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nc_only_s</span> <span class="o">+</span> <span class="n">intsep</span> <span class="o">+</span> <span class="n">func</span><span class="p">(</span><span class="n">NC</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">flavintsep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">strs</span><span class="p">)</span>

<div class="viewcode-block" id="NuFlavIntGroup.simple_str">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.simple_str">[docs]</a>
    <span class="k">def</span> <span class="nf">simple_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flavsep</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">intsep</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">flavintsep</span><span class="o">=</span><span class="s1">&#39;, &#39;</span><span class="p">,</span>
                   <span class="n">addsep</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple string representation of this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__simple_str</span><span class="p">(</span><span class="n">flavsep</span><span class="o">=</span><span class="n">flavsep</span><span class="p">,</span> <span class="n">intsep</span><span class="o">=</span><span class="n">intsep</span><span class="p">,</span>
                                 <span class="n">flavintsep</span><span class="o">=</span><span class="n">flavintsep</span><span class="p">,</span> <span class="n">addsep</span><span class="o">=</span><span class="n">addsep</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span></div>


<div class="viewcode-block" id="NuFlavIntGroup.file_str">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.file_str">[docs]</a>
    <span class="k">def</span> <span class="nf">file_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flavsep</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">intsep</span><span class="o">=</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="n">flavintsep</span><span class="o">=</span><span class="s1">&#39;__&#39;</span><span class="p">,</span> <span class="n">addsep</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;String representation for this group useful for file names&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__simple_str</span><span class="p">(</span><span class="n">flavsep</span><span class="o">=</span><span class="n">flavsep</span><span class="p">,</span> <span class="n">intsep</span><span class="o">=</span><span class="n">intsep</span><span class="p">,</span>
                                 <span class="n">flavintsep</span><span class="o">=</span><span class="n">flavintsep</span><span class="p">,</span> <span class="n">addsep</span><span class="o">=</span><span class="n">addsep</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span></div>


<div class="viewcode-block" id="NuFlavIntGroup.simple_tex">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.NuFlavIntGroup.simple_tex">[docs]</a>
    <span class="k">def</span> <span class="nf">simple_tex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flavsep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39; + &#39;</span><span class="p">,</span> <span class="n">intsep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39; \, &#39;</span><span class="p">,</span>
                   <span class="n">flavintsep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;; \; &#39;</span><span class="p">,</span> <span class="n">addsep</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;+&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simplified TeX string reperesentation of this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__simple_str</span><span class="p">(</span>
            <span class="n">flavsep</span><span class="o">=</span><span class="n">flavsep</span><span class="p">,</span> <span class="n">intsep</span><span class="o">=</span><span class="n">intsep</span><span class="p">,</span>
            <span class="n">flavintsep</span><span class="o">=</span><span class="n">flavintsep</span><span class="p">,</span> <span class="n">addsep</span><span class="o">=</span><span class="n">addsep</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">tex</span>
        <span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TeX string representation for this group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">simple_tex</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">unique_flavs_tex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TeX string representation of the unique flavors present in this</span>
<span class="sd">        group&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s1">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">f</span><span class="o">.</span><span class="n">tex</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavs</span><span class="p">])</span></div>



<span class="n">ALL_NUFLAVINTS</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuall,nuallbar&#39;</span><span class="p">)</span>
<span class="n">ALL_NUCC</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuall_cc,nuallbar_cc&#39;</span><span class="p">)</span>
<span class="n">ALL_NUNC</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuall_nc,nuallbar_nc&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="FlavIntData">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntData">[docs]</a>
<span class="k">class</span> <span class="nc">FlavIntData</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container class for storing data for each NuFlavInt.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val : string, dict, or None</span>
<span class="sd">        Data with which to populate the hierarchy.</span>

<span class="sd">        If string, interpret as PISA resource and load data from it</span>
<span class="sd">        If dict, populate data from the dictionary</span>
<span class="sd">        If None, instantiate with None for all data</span>

<span class="sd">        The interpreted version of `val` must be a valid data structure: A</span>
<span class="sd">        dict with keys &#39;nue&#39;, &#39;numu&#39;, &#39;nutau&#39;, &#39;nue_bar&#39;, &#39;numu_bar&#39;, and</span>
<span class="sd">        &#39;nutau_bar&#39;; and each item corresponding to these keys must itself be a</span>
<span class="sd">        dict with keys &#39;cc&#39; and &#39;nc&#39;.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Accessing data (both for getting and setting) is fairly flexible. It uses</span>
<span class="sd">    dict-like square-brackets syntax, but can accept any object (or two</span>
<span class="sd">    objects) that are convertible to a NuFlav or NuFlavInt object. In the</span>
<span class="sd">    former case, the entire flavor dictionary (which includes both &#39;cc&#39; and</span>
<span class="sd">    &#39;nc&#39;) is returned, while in the latter case whatever lives at the node is</span>
<span class="sd">    returned.</span>

<span class="sd">    Initializing, setting and getting data in various ways:</span>

<span class="sd">    &gt;&gt;&gt; fi_dat = FlavIntData()</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nue&#39;, &#39;cc&#39;] = 1</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nuenc&#39;] = 2</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;numu&#39;] = {&#39;cc&#39;: &#39;cc data...&#39;, &#39;nc&#39;: &#39;nc data...&#39;}</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[NuFlav(16), IntType(1)] == 4</span>

<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nuecc&#39;] == 1</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;NUE_NC&#39;] == 2</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nu_e&#39;] == {&#39;cc&#39;: 1, &#39;nc&#39;: 2}</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nu mu cc&#39;] == &#39;cc data...&#39;</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nu mu&#39;] == {&#39;cc&#39;: &#39;cc data...&#39;, &#39;nc&#39;: &#39;nc data...&#39;}</span>
<span class="sd">    True</span>
<span class="sd">    &gt;&gt;&gt; fi_dat[&#39;nutau cc&#39;] == 4</span>
<span class="sd">    True</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Instantiate empty FlavIntData</span>
            <span class="k">with</span> <span class="n">BarSep</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">):</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">):</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">ALL_NUINT_TYPES</span><span class="p">}</span>
                     <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">ALL_NUFLAVS</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unrecognized `val` type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_interpret_index</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">)</span> \
                <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">with</span> <span class="n">BarSep</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nfi</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">nfi</span><span class="o">.</span><span class="n">flav</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">nfi</span><span class="o">.</span><span class="n">int_type</span><span class="p">)]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">NuFlav</span><span class="p">(</span><span class="n">idx</span><span class="p">))]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid index: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span>
        <span class="n">key_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpret_index</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="n">tgt_obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tgt_obj</span> <span class="o">=</span> <span class="n">tgt_obj</span><span class="p">[</span><span class="n">key_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">tgt_obj</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">key_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpret_index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__validate_inttype_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__translate_inttype_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">tgt_obj</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_list</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">tgt_obj</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">tgt_obj</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">tgt_obj</span><span class="p">,</span> <span class="n">key_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursive, exact equality&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">recursiveEquality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__basic_validate</span><span class="p">(</span><span class="n">fi_container</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">flavint</span> <span class="ow">in</span> <span class="n">ALL_NUFLAVINTS</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">BarSep</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">flavint</span><span class="o">.</span><span class="n">flav</span><span class="p">)</span>
                <span class="n">it</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">flavint</span><span class="o">.</span><span class="n">int_type</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fi_container</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s2">&quot;container must be of&quot;</span> \
                    <span class="s2">&quot; type &#39;dict&#39;; instead got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">fi_container</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fi_container</span><span class="p">,</span> <span class="s2">&quot;container missing flavor &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">f</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fi_container</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> <span class="nb">dict</span><span class="p">),</span> \
                    <span class="s2">&quot;Child of flavor &#39;</span><span class="si">%s</span><span class="s2">&#39;: must be type &#39;dict&#39; but&quot;</span> \
                    <span class="s2">&quot; got </span><span class="si">%s</span><span class="s2"> instead&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">fi_container</span><span class="p">[</span><span class="n">f</span><span class="p">]))</span>
            <span class="k">assert</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">fi_container</span><span class="p">[</span><span class="n">f</span><span class="p">],</span> \
                    <span class="s2">&quot;Flavor &#39;</span><span class="si">%s</span><span class="s2">&#39; sub-dict must contain a both interaction&quot;</span> \
                    <span class="s2">&quot; types, but missing (at least) int_type &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__validate_inttype_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">MutableMapping</span><span class="p">),</span> \
                <span class="s2">&quot;Value must be an inttype (sub-) dict if you only specify a&quot;</span> \
                <span class="s2">&quot; flavor (and not an int type) as key&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> \
                <span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">keys</span><span class="p">)]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">]),</span> \
                <span class="s2">&quot;inttype (sub-) dict must contain exactly &#39;cc&#39; and &#39;nc&#39; keys&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__translate_inttype_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">__load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flavs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;tuple of NuFlav : all flavors present&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">([</span><span class="n">NuFlav</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">()]))</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flavints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;tuple of NuFlavInt : all flavints present&quot;&quot;&quot;</span>
        <span class="n">fis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">flav</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">int_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[</span><span class="n">flav</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">fis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="p">,</span> <span class="n">int_type</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">fis</span><span class="p">))</span>

<div class="viewcode-block" id="FlavIntData.allclose">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntData.allclose">[docs]</a>
    <span class="k">def</span> <span class="nf">allclose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if all data structures are equal and all numerical</span>
<span class="sd">        values contained are within relative (rtol) and/or absolute (atol)</span>
<span class="sd">        tolerance of one another.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">recursiveAllclose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlavIntData.validate">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntData.validate">[docs]</a>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fi_container</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform basic validation on the data structure&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__basic_validate</span><span class="p">(</span><span class="n">fi_container</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlavIntData.save">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntData.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save data structure to a file; see fileio.to_file for details&quot;&quot;&quot;</span>
        <span class="n">fileio</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlavIntData.id_dupes">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntData.id_dupes">[docs]</a>
    <span class="k">def</span> <span class="nf">id_dupes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Identify flavints with duplicated data (exactly or within a</span>
<span class="sd">        specified tolerance), convert these NuFlavInt&#39;s into NuFlavIntGroup&#39;s</span>
<span class="sd">        and returning these along with the data associated with each.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rtol</span>
<span class="sd">            Set to positive value to use as rtol argument for numpy allclose</span>
<span class="sd">        atol</span>
<span class="sd">            Set to positive value to use as atol argument for numpy allclose</span>

<span class="sd">        If either `rtol` or `atol` is 0, exact equality is enforced.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dupe_flavintgroups : list of NuFlavIntGroup</span>
<span class="sd">            A NuFlavIntGroup object is returned for each group of NuFlavInt&#39;s</span>
<span class="sd">            found with duplicate data</span>
<span class="sd">        dupe_flavintgroups_data : list of objects</span>
<span class="sd">            Data associated with each NuFlavIntGroup in dupe_flavintgroups.</span>
<span class="sd">            Each object in `dupe_flavintgroups_data` corresponds to, and in the</span>
<span class="sd">            same order as, the objects in `dupe_flavintgroups`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">exact_equality</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">rtol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">rtol</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">atol</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exact_equality</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;rtol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rtol</span>
        <span class="k">if</span> <span class="n">atol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">atol</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">rtol</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">exact_equality</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;atol&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">atol</span>
        <span class="k">if</span> <span class="n">exact_equality</span><span class="p">:</span>
            <span class="n">cmpfunc</span> <span class="o">=</span> <span class="n">recursiveEquality</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cmpfunc</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">recursiveAllclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">dupe_flavintgroups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dupe_flavintgroups_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">flavint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavints</span><span class="p">:</span>
            <span class="n">this_datum</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">flavint</span><span class="p">]</span>
            <span class="n">match</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">group_datum</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dupe_flavintgroups_data</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">this_datum</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">group_datum</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">cmpfunc</span><span class="p">(</span><span class="n">this_datum</span><span class="p">,</span> <span class="n">group_datum</span><span class="p">):</span>
                    <span class="n">dupe_flavintgroups</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+=</span> <span class="n">flavint</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">dupe_flavintgroups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">flavint</span><span class="p">))</span>
                <span class="n">dupe_flavintgroups_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">this_datum</span><span class="p">)</span>

        <span class="n">sort_inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">dupe_flavintgroups</span><span class="p">)</span>
        <span class="n">dupe_flavintgroups</span> <span class="o">=</span> <span class="p">[</span><span class="n">dupe_flavintgroups</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sort_inds</span><span class="p">]</span>
        <span class="n">dupe_flavintgroups_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">dupe_flavintgroups_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                                   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">sort_inds</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">dupe_flavintgroups</span><span class="p">,</span> <span class="n">dupe_flavintgroups_data</span></div>
</div>



<div class="viewcode-block" id="FlavIntDataGroup">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntDataGroup">[docs]</a>
<span class="k">class</span> <span class="nc">FlavIntDataGroup</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container class for storing data for some set(s) of NuFlavIntGroups</span>
<span class="sd">    (cf. FlavIntData, which stores one datum for each NuFlavInt separately)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    val: None, str, or dict</span>
<span class="sd">        Data with which to populate the hierarchy</span>
<span class="sd">    flavint_groups: None, str, or iterable</span>
<span class="sd">        User-defined groupings of NuFlavIntGroups. These can be specified</span>
<span class="sd">        in several ways.</span>

<span class="sd">        None</span>
<span class="sd">            If val == None, flavint_groups must be specified</span>
<span class="sd">            If val != None, flavitn_groups are deduced from the data</span>
<span class="sd">        string</span>
<span class="sd">            If val is a string, it is expected to be a comma-separated</span>
<span class="sd">            list, each field of which describes a NuFlavIntGroup. The</span>
<span class="sd">            returned list of groups encompasses all possible flavor/int</span>
<span class="sd">            types, but the groups are mutually exclusive.</span>
<span class="sd">        iterable of strings or NuFlavIntGroup</span>
<span class="sd">            If val is an iterable, each member of the iterable is</span>
<span class="sd">            interpreted as a NuFlavIntGroup.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">flavint_groups</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flavint_groups</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">flavint_groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Error - must input at least one of &#39;</span>
                                 <span class="s1">&#39;`flavint_groups` or `val`.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span> <span class="o">=</span> <span class="n">flavint_groups</span>

        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Instantiate empty FlavIntDataGroup</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">):</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__load</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">val</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unrecognized `val` type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="nb">str</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">key</span><span class="p">)):</span> <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
            <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;NuFlavIntGroups not found in data keys&#39;</span><span class="p">)</span>

            <span class="n">fig</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
            <span class="k">if</span> <span class="n">flavint_groups</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span> <span class="o">=</span> <span class="n">fig</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">set</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Specified `flavint_groups` does not match `val` &#39;</span>
                        <span class="s1">&#39;signature.</span><span class="se">\n</span><span class="s1">`flavint_groups` - </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">`val groups` &#39;</span>
                        <span class="s1">&#39;- </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">flavint_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_flavint_groups</span>

    <span class="nd">@flavint_groups</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">flavint_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="s1">&#39;muons&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_flavint_groups</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="n">all_flavints</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">flavints</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fig</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">fi</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">all_flavints</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">all_flavints</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">fi</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;FlavInt </span><span class="si">{0}</span><span class="s1"> referred to multiple times in flavint_group &#39;</span>
                    <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fi</span><span class="p">,</span> <span class="n">fig</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_flavint_groups</span> <span class="o">=</span> <span class="n">fig</span>

<div class="viewcode-block" id="FlavIntDataGroup.transform_groups">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntDataGroup.transform_groups">[docs]</a>
    <span class="k">def</span> <span class="nf">transform_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flavint_groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Transform FlavIntDataGroup into a structure given by the input</span>
<span class="sd">        flavint_groups.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        flavint_groups : string, or sequence of strings or sequence of</span>
<span class="sd">                         NuFlavIntGroups</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        transformed_fidg : FlavIntDataGroup</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">flavint_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_flavint_groups</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">)</span>

        <span class="n">original_flavints</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
                                         <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">])</span>
        <span class="n">inputted_flavints</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
                                         <span class="n">flavint_groups</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">inputted_flavints</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">original_flavints</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Mismatch between underlying group of flavints given as input &#39;</span>
                <span class="s1">&#39;and original flavint_group.</span><span class="se">\n</span><span class="s1">Original </span><span class="si">{0}</span><span class="se">\n</span><span class="s1">Inputted &#39;</span>
                <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">original_flavints</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="n">inputted_flavints</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="n">transformed_fidg</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">flavint_groups</span><span class="o">=</span><span class="n">flavint_groups</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">in_fig</span> <span class="ow">in</span> <span class="n">flavint_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">or_fig</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">or_fig</span> <span class="ow">in</span> <span class="n">in_fig</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">transformed_fidg</span><span class="p">[</span><span class="n">in_fig</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">transformed_fidg</span><span class="p">[</span><span class="n">in_fig</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">or_fig</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">transformed_fidg</span><span class="p">[</span><span class="n">in_fig</span><span class="p">]</span> <span class="o">=</span> \
                                <span class="bp">self</span><span class="o">.</span><span class="n">_merge</span><span class="p">(</span><span class="n">transformed_fidg</span><span class="p">[</span><span class="n">in_fig</span><span class="p">],</span>
                                            <span class="bp">self</span><span class="p">[</span><span class="n">or_fig</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">in_fig</span> <span class="ow">in</span> <span class="n">or_fig</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;Cannot decouple original flavint_group </span><span class="si">{0}</span><span class="s1"> into input&#39;</span>
                        <span class="s1">&#39;flavint_group </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">or_fig</span><span class="p">,</span> <span class="n">in_fig</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;Transformed from</span><span class="se">\n</span><span class="si">{0}</span><span class="se">\n</span><span class="s1">to &#39;</span>
                      <span class="s1">&#39;</span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">,</span> <span class="n">flavint_groups</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">transformed_fidg</span></div>


<div class="viewcode-block" id="FlavIntDataGroup.allclose">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntDataGroup.allclose">[docs]</a>
    <span class="k">def</span> <span class="nf">allclose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns True if all data structures are equal and all numerical</span>
<span class="sd">        values contained are within relative (rtol) and/or absolute (atol)</span>
<span class="sd">        tolerance of one another.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">recursiveAllclose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="n">rtol</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="n">atol</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlavIntDataGroup.validate">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntDataGroup.validate">[docs]</a>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fi_container</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform basic validation on the data structure&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__basic_validate</span><span class="p">(</span><span class="n">fi_container</span><span class="p">)</span></div>


<div class="viewcode-block" id="FlavIntDataGroup.save">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.FlavIntDataGroup.save">[docs]</a>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save data structure to a file; see fileio.to_file for details&quot;&quot;&quot;</span>
        <span class="n">fileio</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_flavint_groups</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">flavintGroupsFromString</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">,</span> <span class="n">NuFlavIntGroup</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">flavint_groups</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">NuFlavIntGroup</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flavint_groups</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">flavint_groups</span>
            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">NuFlavInt</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flavint_groups</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flavint_groups</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flavint_groups</span><span class="p">):</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">flavint_groups</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s1">&#39;Elements in `flavint_groups` not all type &#39;</span>
                    <span class="s1">&#39;NuFlavIntGroup or string: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">flavint_groups</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Unrecognized `flavint_groups` type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span>
                            <span class="nb">type</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">))</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_merge</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Merge dictionaries `a` and `b` by recursively iterating down</span>
<span class="sd">        to the lowest level of the dictionary until coincident numpy</span>
<span class="sd">        arrays are found, after which the appropriate sub-element is</span>
<span class="sd">        made equal to the concatenation of the two arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">FlavIntDataGroup</span><span class="o">.</span><span class="n">_merge</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">)</span> <span class="ow">and</span> \
                        <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">ureg</span><span class="o">.</span><span class="n">Quantity</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">and</span> \
                       <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                        <span class="n">units</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">units</span>
                        <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">m</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">m_as</span><span class="p">(</span><span class="n">units</span><span class="p">)))</span>
                        <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="n">units</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                            <span class="s1">&#39;Conflict at </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s1">&#39;Conflict at </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)])</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">a</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">a</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_interpret_index</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nfi</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">nfi</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid index: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__basic_validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fi_container</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fi_container</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s2">&quot;container must be of&quot;</span> \
                    <span class="s2">&quot; type &#39;dict&#39;; instead got </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">fi_container</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fi_container</span><span class="p">,</span> \
                    <span class="s2">&quot;container missing flavint group &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">f</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__load</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_merge</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
        <span class="n">combined_flavint_groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span> <span class="o">+</span> <span class="n">other</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">d</span><span class="p">,</span> <span class="n">flavint_groups</span><span class="o">=</span><span class="n">combined_flavint_groups</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpret_index</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="n">tgt_obj</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tgt_obj</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpret_index</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flavint_groups</span> <span class="o">+=</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recursive, exact equality&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">recursiveEquality</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>



<div class="viewcode-block" id="flavintGroupsFromString">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.flavintGroupsFromString">[docs]</a>
<span class="k">def</span> <span class="nf">flavintGroupsFromString</span><span class="p">(</span><span class="n">groups</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpret `groups` to break into neutrino flavor/interaction type(s)</span>
<span class="sd">    that are to be grouped together; also form singleton groups as specified</span>
<span class="sd">    explicitly in `groups` or for any unspecified flavor/interaction type(s).</span>

<span class="sd">    The returned list of groups encompasses all possible flavor/int types, but</span>
<span class="sd">    the groups are mutually exclusive.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    groups : None, string, or sequence of strings</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    flavint_groups : list of NuFlavIntGroup</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">groups</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">groups</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="c1"># None are to be grouped together</span>
        <span class="n">grouped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># All will be singleton groups</span>
        <span class="n">ungrouped</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ALL_NUFLAVINTS</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grouped</span><span class="p">,</span> <span class="n">ungrouped</span> <span class="o">=</span> <span class="n">xlateGroupsStr</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>

    <span class="c1"># Find any flavints not included in the above groupings</span>
    <span class="n">flavint_groups</span> <span class="o">=</span> <span class="n">grouped</span> <span class="o">+</span> <span class="n">ungrouped</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;flav/int in the following group(s) will be joined together:&#39;</span>
                  <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">]))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;flav/ints treated individually:&#39;</span>
                  <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ungrouped</span><span class="p">]))</span>

    <span class="c1"># Enforce that flavints composing groups are mutually exclusive</span>
    <span class="k">for</span> <span class="n">grp0</span><span class="p">,</span> <span class="n">grp1</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">grp0</span><span class="p">)</span><span class="o">.</span><span class="n">isdisjoint</span><span class="p">(</span><span class="n">grp1</span><span class="p">):</span>
            <span class="n">overlapping</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">grp0</span><span class="p">)</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">grp1</span><span class="p">))</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;All flavint groups must be disjoint with one another, but&#39;</span>
                <span class="s1">&#39; groups </span><span class="si">%s</span><span class="s1"> and </span><span class="si">%s</span><span class="s1"> have overlapping flavint(s): </span><span class="si">%s</span><span class="s1">&#39;</span>
                <span class="o">%</span> <span class="p">(</span><span class="n">grp0</span><span class="p">,</span> <span class="n">grp1</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">overlapping</span><span class="p">))</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">flavint_groups</span><span class="p">)</span></div>



<div class="viewcode-block" id="xlateGroupsStr">
<a class="viewcode-back" href="../../../pisa.utils.html#pisa.utils.flavInt.xlateGroupsStr">[docs]</a>
<span class="k">def</span> <span class="nf">xlateGroupsStr</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Translate a &quot;,&quot;-separated string into separate `NuFlavIntGroup`s.</span>

<span class="sd">    val</span>
<span class="sd">        &quot;,&quot;-delimited list of valid NuFlavIntGroup strings, e.g.:</span>
<span class="sd">            &quot;nuall_nc,nue,numu_cc+numubar_cc&quot;</span>
<span class="sd">        Note that specifying NO interaction type results in both interaction</span>
<span class="sd">        types being selected, e.g. &quot;nue&quot; implies &quot;nue_cc+nue_nc&quot;. For other</span>
<span class="sd">        details of how the substrings are interpreted, see docs for</span>
<span class="sd">        NuFlavIntGroup.</span>

<span class="sd">    returns:</span>
<span class="sd">        grouped, ungrouped</span>

<span class="sd">    grouped, ungrouped</span>
<span class="sd">        lists of NuFlavIntGroups; the first will have more than one flavint</span>
<span class="sd">        in each NuFlavIntGroup whereas the second will have just one</span>
<span class="sd">        flavint in each NuFlavIntGroup. Either list can be of 0-length.</span>

<span class="sd">    This function does not enforce mutual-exclusion on flavints in the</span>
<span class="sd">    various flavint groupings, but does list any flavints not grouped</span>
<span class="sd">    together in the `ungrouped` return arg. Mutual exclusion can be</span>
<span class="sd">    enforced through set operations upon return.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># What flavints to group together</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[,;]&#39;</span><span class="p">,</span> <span class="n">val</span><span class="p">)]</span>

    <span class="c1"># Find any flavints not included in the above groupings</span>
    <span class="n">all_flavints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ALL_NUFLAVINTS</span><span class="p">)</span>
    <span class="n">all_grouped_flavints</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">grouped</span><span class="p">))</span>
    <span class="n">ungrouped</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span>
                 <span class="nb">sorted</span><span class="p">(</span><span class="n">all_flavints</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">all_grouped_flavints</span><span class="p">))]</span>

    <span class="k">return</span> <span class="n">grouped</span><span class="p">,</span> <span class="n">ungrouped</span></div>



<span class="c1"># pylint: disable=line-too-long</span>
<span class="k">def</span> <span class="nf">test_IntType</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;IntType unit tests&quot;&quot;&quot;</span>
    <span class="c1">#==========================================================================</span>
    <span class="c1"># Test IntType</span>
    <span class="c1">#==========================================================================</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">CC</span>
    <span class="k">assert</span> <span class="n">IntType</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n\t</span><span class="s1"> _cc </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">IntType</span><span class="p">(</span><span class="s1">&#39;numubarcc&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">IntType</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">IntType</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">IntType</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">IntType</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numubarcc&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">for</span> <span class="n">int_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
        <span class="n">IntType</span><span class="p">(</span><span class="n">int_code</span><span class="p">)</span>
        <span class="n">IntType</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">int_code</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&lt;&lt; PASS : test_IntType &gt;&gt;&#39;</span><span class="p">)</span>


<span class="c1"># pylint: disable=line-too-long</span>
<span class="k">def</span> <span class="nf">test_NuFlav</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NuFlav unit tests&quot;&quot;&quot;</span>
    <span class="n">all_f_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">]</span>

    <span class="c1">#==========================================================================</span>
    <span class="c1"># Test NuFlav</span>
    <span class="c1">#==========================================================================</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">ref</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="mi">14</span>
    <span class="k">assert</span> <span class="p">(</span><span class="o">-</span><span class="n">ref</span><span class="p">)</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">14</span>
    <span class="k">assert</span> <span class="n">ref</span><span class="o">.</span><span class="n">bar_code</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="p">(</span><span class="o">-</span><span class="n">ref</span><span class="p">)</span><span class="o">.</span><span class="n">bar_code</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">assert</span> <span class="n">ref</span><span class="o">.</span><span class="n">particle</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="o">-</span><span class="n">ref</span><span class="p">)</span><span class="o">.</span><span class="n">particle</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">ref</span><span class="o">.</span><span class="n">antiparticle</span>
    <span class="k">assert</span> <span class="p">(</span><span class="o">-</span><span class="n">ref</span><span class="p">)</span><span class="o">.</span><span class="n">antiparticle</span>

    <span class="c1">#assert NuFlav(&#39;\n\t _ nu_ mu_ cc\n\t\r&#39;) == ref</span>
    <span class="c1">#assert NuFlav(&#39;numucc&#39;) == ref</span>
    <span class="k">assert</span> <span class="n">NuFlav</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">NuFlav</span><span class="p">(</span><span class="mf">14.0</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numucc&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">ref</span>
    <span class="k">assert</span> <span class="n">NuFlav</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numunc&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="n">ref</span>

    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">all_f_codes</span><span class="p">:</span>
        <span class="n">NuFlav</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">NuFlav</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">bnb</span><span class="p">)</span> <span class="ow">in</span> <span class="n">product</span><span class="p">([</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]):</span>
        <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nu_&#39;</span> <span class="o">+</span> <span class="n">f</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">bnb</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&lt;&lt; PASS : test_NuFlav &gt;&gt;&#39;</span><span class="p">)</span>


<span class="c1"># pylint: disable=line-too-long</span>
<span class="k">def</span> <span class="nf">test_NuFlavInt</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NuFlavInt unit tests&quot;&quot;&quot;</span>
    <span class="n">all_f_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">all_i_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1">#==========================================================================</span>
    <span class="c1"># Test NuFlavInt</span>
    <span class="c1">#==========================================================================</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Equality</span>
    <span class="n">fi_comb</span> <span class="o">=</span> <span class="p">[</span><span class="n">fic</span> <span class="k">for</span> <span class="n">fic</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">all_f_codes</span><span class="p">,</span> <span class="n">all_i_codes</span><span class="p">)]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">fi0</span><span class="p">,</span> <span class="n">fi1</span><span class="p">)</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">fi_comb</span><span class="p">,</span> <span class="n">fi_comb</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">fi0</span> <span class="o">==</span> <span class="n">fi1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">fi0</span><span class="p">)</span> <span class="o">==</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">fi1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">fi0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">fi1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">!=</span> <span class="s1">&#39;xyz&#39;</span>
    <span class="c1"># Sorting: this is my desired sort order</span>
    <span class="n">nfl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">NUECC</span><span class="p">,</span> <span class="n">NUEBARCC</span><span class="p">,</span> <span class="n">NUMUCC</span><span class="p">,</span> <span class="n">NUMUBARCC</span><span class="p">,</span> <span class="n">NUTAUCC</span><span class="p">,</span> <span class="n">NUTAUBARCC</span><span class="p">,</span> <span class="n">NUENC</span><span class="p">,</span>
            <span class="n">NUEBARNC</span><span class="p">,</span> <span class="n">NUMUNC</span><span class="p">,</span> <span class="n">NUMUBARNC</span><span class="p">,</span> <span class="n">NUTAUNC</span><span class="p">,</span> <span class="n">NUTAUBARNC</span><span class="p">]</span>
    <span class="n">nfl1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">nfl0</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">nfl1</span><span class="p">)</span>
    <span class="n">nfl_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nfl1</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="n">v0</span> <span class="o">==</span> <span class="n">nfl_sorted</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nfl0</span><span class="p">)]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">nfl_sorted</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfl0</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">nfl_sorted</span><span class="p">)</span>

    <span class="c1"># Test NuFlavInt instantiation</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nue&#39;</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="s1">&#39;cc&#39;</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">IntType</span><span class="p">(</span><span class="s1">&#39;nc&#39;</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nuebar&#39;</span><span class="p">)</span>
    <span class="n">flavs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ALL_NUFLAVS</span><span class="p">)</span>
    <span class="n">flavs</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;nue&#39;</span><span class="p">,</span> <span class="s1">&#39;numu&#39;</span><span class="p">,</span> <span class="s1">&#39;nutau&#39;</span><span class="p">,</span> <span class="s1">&#39;nu_e&#39;</span><span class="p">,</span> <span class="s1">&#39;nu e&#39;</span><span class="p">,</span> <span class="s1">&#39;Nu E&#39;</span><span class="p">,</span> <span class="s1">&#39;nuebar&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;nu e bar&#39;</span><span class="p">])</span>
    <span class="n">flavs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">all_f_codes</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuebarnc&#39;</span><span class="p">)</span>

    <span class="c1"># Instantiate with combinations of flavs and int types</span>
    <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">flavs</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">,</span> <span class="n">CC</span><span class="p">,</span> <span class="n">NC</span><span class="p">]):</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="o">==</span> <span class="n">ref</span>
        <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">flav</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">int_type</span><span class="o">=</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">f</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
            <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>
            <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">f</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref</span>

    <span class="c1"># Instantiate with already-instantiated `NuFlavInt`s</span>
    <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">NUECC</span><span class="p">)</span> <span class="o">==</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuecc&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">NUEBARNC</span><span class="p">)</span> <span class="o">==</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nuebarnc&#39;</span><span class="p">)</span>

    <span class="c1"># test negating flavint</span>
    <span class="n">nk</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numucc&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="o">-</span><span class="n">nk</span> <span class="o">==</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numubarcc&#39;</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&lt;&lt; PASS : test_NuFlavInt &gt;&gt;&#39;</span><span class="p">)</span>


<span class="c1"># pylint: disable=line-too-long</span>
<span class="k">def</span> <span class="nf">test_NuFlavIntGroup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;NuFlavIntGroup unit tests&quot;&quot;&quot;</span>
    <span class="n">all_f_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">]</span>
    <span class="n">all_i_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

    <span class="c1">#==========================================================================</span>
    <span class="c1"># Test NuFlavIntGroup</span>
    <span class="c1">#==========================================================================</span>
    <span class="n">fi_comb</span> <span class="o">=</span> <span class="p">[</span><span class="n">fic</span> <span class="k">for</span> <span class="n">fic</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="n">all_f_codes</span><span class="p">,</span> <span class="n">all_i_codes</span><span class="p">)]</span>
    <span class="n">nfl0</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">fic</span><span class="p">)</span> <span class="k">for</span> <span class="n">fic</span> <span class="ow">in</span> <span class="n">fi_comb</span><span class="p">]</span>
    <span class="n">nfl1</span> <span class="o">=</span> <span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="n">fic</span><span class="p">)</span> <span class="k">for</span> <span class="n">fic</span> <span class="ow">in</span> <span class="n">fi_comb</span><span class="p">]</span>
    <span class="n">nfl_sorted</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">nfl1</span><span class="p">)</span>
    <span class="n">nkg0</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nfl0</span><span class="p">)</span>
    <span class="n">nkg1</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nfl_sorted</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">nkg0</span> <span class="o">==</span> <span class="n">nkg1</span>
    <span class="k">assert</span> <span class="n">nkg0</span> <span class="o">!=</span> <span class="s1">&#39;xyz&#39;</span>
    <span class="k">assert</span> <span class="n">nkg0</span> <span class="o">!=</span> <span class="s1">&#39;xyz&#39;</span>

    <span class="c1"># Test inputs</span>
    <span class="k">assert</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuall,nuallbar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flavs</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">NuFlav</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">all_f_codes</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuall,nuallbar&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flavs</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Test NuFlavIntGroup instantiation</span>
    <span class="c1">#</span>
    <span class="n">nue</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;nue&#39;</span><span class="p">)</span>
    <span class="n">numu</span> <span class="o">=</span> <span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)</span>
    <span class="n">nue_cc</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nue_cc&#39;</span><span class="p">)</span>
    <span class="n">nue_nc</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nue_nc&#39;</span><span class="p">)</span>

    <span class="c1"># Empty args</span>
    <span class="n">NuFlavIntGroup</span><span class="p">()</span>
    <span class="n">NuFlavIntGroup</span><span class="p">([])</span>

    <span class="c1"># String flavor promoted to CC+NC</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nue&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>
    <span class="c1"># NuFlav promoted to CC+NC</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nue</span><span class="p">)</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>
    <span class="c1"># List of single flav str same as above</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">([</span><span class="s1">&#39;nue&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>
    <span class="c1"># List of single flav same as above</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">([</span><span class="n">nue</span><span class="p">])</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>

    <span class="c1"># Single flavint spec</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nue_cc</span><span class="p">)</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,))</span>
    <span class="c1"># Str with single flavint spec</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nue_cc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,))</span>
    <span class="c1"># List of single str containing single flavint spec</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">([</span><span class="s1">&#39;nue_cc&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,))</span>

    <span class="c1"># Multiple flavints as *args</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">)</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>
    <span class="c1"># List of flavints</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">([</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">])</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>
    <span class="c1"># List of single str containing multiple flavints spec</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">([</span><span class="s1">&#39;nue_cc,nue_nc&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>
    <span class="c1"># List of str containing flavints spec</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">([</span><span class="s1">&#39;nue_cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nue_nc&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>

    <span class="c1"># Another NuFlavIntGroup</span>
    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span><span class="o">.</span><span class="n">flavints</span><span class="p">)</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="n">nue_cc</span><span class="p">,</span> <span class="n">nue_nc</span><span class="p">))</span>

    <span class="c1"># Addition of flavints promoted to NuFlavIntGroup</span>
    <span class="k">assert</span> <span class="n">nue_cc</span> <span class="o">+</span> <span class="n">nue_nc</span> <span class="o">==</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nue</span><span class="p">)</span>
    <span class="c1"># Addition of flavs promoted to NuFlavIntGroup including both CC &amp; NC</span>
    <span class="k">assert</span> <span class="n">nue</span> <span class="o">+</span> <span class="n">numu</span> <span class="o">==</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">nue</span><span class="p">,</span> <span class="n">numu</span><span class="p">)</span>

    <span class="c1"># Test remove</span>
    <span class="n">nkg</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nue_cc+numucc&#39;</span><span class="p">)</span>
    <span class="n">nkg</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">NuFlavInt</span><span class="p">((</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
    <span class="k">assert</span> <span class="n">nkg</span> <span class="o">==</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;numucc&#39;</span><span class="p">)</span>

    <span class="c1"># Test del</span>
    <span class="n">nkg</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nue_cc+numucc&#39;</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">nkg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">nkg</span> <span class="o">==</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;numucc&#39;</span><span class="p">)</span>

    <span class="c1"># Equivalent object when converting to string and back to NuFlavIntGroup from</span>
    <span class="c1"># that string</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ALL_NUFLAVINTS</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;NuFlavIntGroup --&gt; str --&gt; NuFlavIntGroup, n = </span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">combinations</span><span class="p">(</span><span class="n">ALL_NUFLAVINTS</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">comb</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">ref</span> <span class="o">==</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ref</span><span class="p">))</span>

    <span class="c1"># Ordering</span>
    <span class="n">desired_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s1">&#39;nuecc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuebarcc&#39;</span><span class="p">,</span> <span class="s1">&#39;numucc&#39;</span><span class="p">,</span> <span class="s1">&#39;numubarcc&#39;</span><span class="p">,</span> <span class="s1">&#39;nutaucc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nutaubarcc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuallnc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuallbarnc&#39;</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">flavintGroupsFromString</span><span class="p">(</span><span class="s1">&#39;nuallnc, nuallbarnc&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">groups</span> <span class="o">==</span> <span class="n">desired_order</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="n">desired_order</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>

    <span class="n">desired_order</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s1">&#39;nuecc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuebarcc&#39;</span><span class="p">,</span> <span class="s1">&#39;numucc&#39;</span><span class="p">,</span> <span class="s1">&#39;numubarcc&#39;</span><span class="p">,</span> <span class="s1">&#39;nutaucc&#39;</span><span class="p">,</span>
            <span class="s1">&#39;nutaubarcc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuallnc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuallbarnc&#39;</span>
        <span class="p">]</span>
    <span class="p">]</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="n">flavintGroupsFromString</span><span class="p">(</span><span class="s1">&#39;nuallnc, nuallbarnc&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">groups</span> <span class="o">==</span> <span class="n">desired_order</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span> <span class="o">==</span> <span class="n">desired_order</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">groups</span><span class="p">))</span>

    <span class="c1"># test TeX strings</span>
    <span class="n">nkg</span> <span class="o">=</span> <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuall,nuallbar&#39;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nkg</span><span class="p">))</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">nkg</span><span class="o">.</span><span class="n">tex</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">nkg</span><span class="o">.</span><span class="n">simple_str</span><span class="p">())</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">nkg</span><span class="o">.</span><span class="n">simple_tex</span><span class="p">())</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">nkg</span><span class="o">.</span><span class="n">unique_flavs_tex</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&lt;&lt; ???? : test_NuFlavIntGroup &gt;&gt; checks pass upon inspection&#39;</span>
                 <span class="s1">&#39; of above outputs and generated file(s).&#39;</span><span class="p">)</span>


<span class="c1"># pylint: disable=line-too-long</span>
<span class="k">def</span> <span class="nf">test_FlavIntData</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FlavIntData unit tests&quot;&quot;&quot;</span>
    <span class="c1">#==========================================================================</span>
    <span class="c1"># Test FlavIntData</span>
    <span class="c1">#==========================================================================</span>
    <span class="c1"># Excercise the &quot;standard&quot; PISA nested-python-dict features, where this</span>
    <span class="c1"># dict uses an &#39;_&#39; to separate &#39;bar&#39; in key names, and the nested dict</span>
    <span class="c1"># levels are [flavor][interaction type].</span>

    <span class="c1"># Force separator to something weird before starting, to ensure everything</span>
    <span class="c1"># still works and this separator is still set when we&#39;re done</span>
    <span class="n">oddball_sep</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span>
    <span class="n">set_bar_ssep</span><span class="p">(</span><span class="n">oddball_sep</span><span class="p">)</span>
    <span class="n">ref_pisa_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="p">:</span> <span class="p">{</span><span class="n">it</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">]}</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span>
                     <span class="p">[</span><span class="s1">&#39;nue&#39;</span><span class="p">,</span> <span class="s1">&#39;nue_bar&#39;</span><span class="p">,</span> <span class="s1">&#39;numu&#39;</span><span class="p">,</span> <span class="s1">&#39;numu_bar&#39;</span><span class="p">,</span> <span class="s1">&#39;nutau&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;nutau_bar&#39;</span><span class="p">]}</span>
    <span class="n">fi_cont</span> <span class="o">=</span> <span class="n">FlavIntData</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nue&#39;</span><span class="p">,</span> <span class="s1">&#39;nue_bar&#39;</span><span class="p">,</span> <span class="s1">&#39;numu&#39;</span><span class="p">,</span> <span class="s1">&#39;numu_bar&#39;</span><span class="p">,</span> <span class="s1">&#39;nutau&#39;</span><span class="p">,</span> <span class="s1">&#39;nutau_bar&#39;</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">]:</span>
            <span class="k">assert</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">it</span><span class="p">]</span> <span class="o">==</span> <span class="n">ref_pisa_dict</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
            <span class="n">flavint</span> <span class="o">=</span> <span class="n">NuFlavInt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">flavint</span><span class="o">.</span><span class="n">pidx</span><span class="p">(</span><span class="n">ref_pisa_dict</span><span class="p">)</span> <span class="o">==</span> <span class="n">ref_pisa_dict</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;flavint&#39;</span><span class="p">,</span> <span class="n">flavint</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="n">f</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;it&#39;</span><span class="p">,</span> <span class="n">it</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;fi_cont&#39;</span><span class="p">,</span> <span class="n">fi_cont</span><span class="p">))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;fi_cont[f]&#39;</span><span class="p">,</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">f</span><span class="p">]))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;fi_cont[f][it]&#39;</span><span class="p">,</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">it</span><span class="p">]))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;fi_cont[flavint]&#39;</span><span class="p">,</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">flavint</span><span class="p">]))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="s1">&#39;fi_cont[flavint]&#39;</span><span class="p">,</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">flavint</span><span class="p">]))</span>
            <span class="k">assert</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">flavint</span><span class="p">]</span> <span class="o">==</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">it</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">flavint</span><span class="p">]</span> <span class="o">==</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">flavint</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">get_bar_ssep</span><span class="p">()</span> <span class="o">==</span> <span class="n">oddball_sep</span>
    <span class="n">set_bar_ssep</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># These should fail because you&#39;re only allowed to access the flav or</span>
    <span class="c1"># flavint part of the data structure, no longer any sub-items (use</span>
    <span class="c1"># subsequent [k1][k2]... to do this instead)</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="s1">&#39;numu&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;sub-key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sub-sub-key&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fi_cont</span><span class="p">[</span><span class="s1">&#39;numu&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-key&#39;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Test failed, exception should have been raised&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fi_cont</span><span class="p">[</span><span class="s1">&#39;numu&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">,</span> <span class="s1">&#39;sub-key&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;new sub-val&#39;</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Test failed, exception should have been raised&#39;</span><span class="p">)</span>

    <span class="c1"># These should fail because setting flavor-only as a string would</span>
    <span class="c1"># invalidate the data structure (not a nested dict)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="s1">&#39;xyz&#39;</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Test failed, exception should have been raised&#39;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;cc_xyz&#39;</span><span class="p">}</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Test failed, exception should have been raised&#39;</span><span class="p">)</span>

    <span class="c1"># The previously-valid fi_cont should *still* be valid, as `set` should</span>
    <span class="c1"># revert to the original (valid) values rather than keep the invalid values</span>
    <span class="c1"># that were attempted to be set above</span>
    <span class="n">fi_cont</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">fi_cont</span><span class="p">)</span>

    <span class="c1"># This should be okay because datastructure is still valid if the item</span>
    <span class="c1"># being set on the flavor (only) is a valid int-type dict</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlav</span><span class="p">(</span><span class="s1">&#39;numu&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cc&#39;</span><span class="p">:</span> <span class="s1">&#39;cc_xyz&#39;</span><span class="p">,</span> <span class="s1">&#39;nc&#39;</span><span class="p">:</span> <span class="s1">&#39;nc_xyz&#39;</span><span class="p">}</span>

    <span class="c1"># Test setting, getting, and JSON serialization of FlavIntData</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="s1">&#39;nue&#39;</span><span class="p">,</span> <span class="s1">&#39;cc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;this is a string blah blah blah&#39;</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nue_cc&#39;</span><span class="p">)]</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nue_nc&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nue_nc&#39;</span><span class="p">)]</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numu_cc&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numu_cc&#39;</span><span class="p">)]</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numu_nc&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;nested&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dict&#39;</span><span class="p">:</span> <span class="s1">&#39;xyz&#39;</span><span class="p">}}}</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;numu_nc&#39;</span><span class="p">)]</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutau_cc&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutau_cc&#39;</span><span class="p">)]</span>
    <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutaubar_cc&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">fi_cont</span><span class="p">[</span><span class="n">NuFlavInt</span><span class="p">(</span><span class="s1">&#39;nutaubar_cc&#39;</span><span class="p">)]</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;/tmp/test_FlavIntData.json&#39;</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Writing FlavIntData to file </span><span class="si">%s</span><span class="s1">; inspect.&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="n">fileio</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">fi_cont</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fi_cont2</span> <span class="o">=</span> <span class="n">fileio</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">recursiveEquality</span><span class="p">(</span><span class="n">fi_cont2</span><span class="p">,</span> <span class="n">fi_cont</span><span class="p">),</span> \
            <span class="s1">&#39;fi_cont=</span><span class="si">%s</span><span class="se">\n</span><span class="s1">fi_cont2=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fi_cont</span><span class="p">,</span> <span class="n">fi_cont2</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&lt;&lt; ???? : test_FlavIntData &gt;&gt; checks pass upon inspection of&#39;</span>
                 <span class="s1">&#39; above outputs and generated file(s).&#39;</span><span class="p">)</span>


<span class="c1"># pylint: disable=line-too-long</span>
<span class="k">def</span> <span class="nf">test_FlavIntDataGroup</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FlavIntDataGroup unit tests&quot;&quot;&quot;</span>
    <span class="n">flavint_group</span> <span class="o">=</span> <span class="s1">&#39;nue, numu_cc+numubar_cc, nutau_cc&#39;</span>
    <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">flavint_groups</span><span class="o">=</span><span class="n">flavint_group</span><span class="p">)</span>
    <span class="n">fidg1</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span>
        <span class="n">flavint_groups</span><span class="o">=</span><span class="s1">&#39;nuall, nu all bar CC, nuallbarnc&#39;</span><span class="p">,</span>
        <span class="n">val</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nuall&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
             <span class="s1">&#39;nu all bar CC&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
             <span class="s1">&#39;nuallbarnc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">)}</span>
    <span class="p">)</span>
    <span class="n">fidg2</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span>
        <span class="n">val</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nuall&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
             <span class="s1">&#39;nu all bar CC&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
             <span class="s1">&#39;nuallbarnc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">)}</span>
    <span class="p">)</span>
    <span class="k">assert</span> <span class="n">fidg1</span> <span class="o">==</span> <span class="n">fidg2</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fidg1</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span>
            <span class="n">flavint_groups</span><span class="o">=</span><span class="s1">&#39;nuall, nu all bar, nuallbar&#39;</span><span class="p">,</span>
            <span class="n">val</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;nuall&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                 <span class="s1">&#39;nu all bar CC&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
                 <span class="s1">&#39;nuallbarnc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">)}</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">fidg1</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">flavint_groups</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;nuall&#39;</span><span class="p">,</span> <span class="s1">&#39;nue&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">fidg1</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">==</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;nuall&#39;</span><span class="p">,</span> <span class="s1">&#39;nuallbar_cc&#39;</span><span class="p">,</span> <span class="s1">&#39;nuallbar_nc&#39;</span><span class="p">))</span>
    <span class="n">fidg1</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/tmp/test_FlavIntDataGroup.json&#39;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fidg1</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;/tmp/test_FlavIntDataGroup.hdf5&#39;</span><span class="p">,</span> <span class="n">warn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">fidg3</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="s1">&#39;/tmp/test_FlavIntDataGroup.json&#39;</span><span class="p">)</span>
    <span class="n">fidg4</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="s1">&#39;/tmp/test_FlavIntDataGroup.hdf5&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">fidg3</span> <span class="o">==</span> <span class="n">fidg1</span>
    <span class="k">assert</span> <span class="n">fidg4</span> <span class="o">==</span> <span class="n">fidg1</span>

    <span class="n">figroups</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;nuecc+nuebarcc,numucc+numubarcc,nutaucc+nutaubarcc,&#39;</span>
                <span class="s1">&#39;nuallnc,nuallbarnc&#39;</span><span class="p">)</span>
    <span class="n">cfidat</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">flavint_groups</span><span class="o">=</span><span class="n">figroups</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">cfidat</span><span class="o">.</span><span class="n">flavint_groups</span><span class="p">:</span>
        <span class="n">cfidat</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">cfidat</span><span class="p">[</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nuecc+nuebarcc&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">fidg1</span> <span class="o">+</span> <span class="n">fidg2</span><span class="p">)))</span>
    <span class="k">assert</span> <span class="n">fidg1</span> <span class="o">==</span> <span class="n">fidg2</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">fidg1</span> <span class="o">+</span> <span class="n">cfidat</span><span class="p">)))</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="n">d1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;numu+numubar&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;nutau+nutaubar&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;energy&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;nue+nuebar&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="s1">&#39;nutau+nutaubar&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;weights&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">d1</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">d1</span><span class="p">)</span>
    <span class="n">d2</span> <span class="o">=</span> <span class="n">FlavIntDataGroup</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">d2</span><span class="p">)</span>
    <span class="n">d3</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">d3</span><span class="p">)))</span>

    <span class="n">tr_d1</span> <span class="o">=</span> <span class="n">d1</span><span class="o">.</span><span class="n">transform_groups</span><span class="p">([</span><span class="s1">&#39;numu+numubar+nutau+nutaubar&#39;</span><span class="p">])</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">tr_d1</span><span class="p">)))</span>
    <span class="n">tr_d3</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">transform_groups</span><span class="p">(</span><span class="s1">&#39;nue+nuebar+numu+numubar, nutau+nutaubar&#39;</span><span class="p">)</span>
    <span class="n">tr_d3_1</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">transform_groups</span><span class="p">([</span><span class="s1">&#39;nue+nuebar+numu+numubar&#39;</span><span class="p">,</span> <span class="s1">&#39;nutau+nutaubar&#39;</span><span class="p">])</span>
    <span class="n">tr_d3_2</span> <span class="o">=</span> <span class="n">d3</span><span class="o">.</span><span class="n">transform_groups</span><span class="p">([</span><span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nue+nuebar+numu+numubar&#39;</span><span class="p">),</span>
                                   <span class="n">NuFlavIntGroup</span><span class="p">(</span><span class="s1">&#39;nutau+nutaubar&#39;</span><span class="p">)])</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="nb">str</span><span class="p">((</span><span class="n">tr_d3</span><span class="p">)))</span>
    <span class="k">assert</span> <span class="n">tr_d3</span> <span class="o">==</span> <span class="n">tr_d3_1</span> <span class="ow">and</span> <span class="n">tr_d3</span> <span class="o">==</span> <span class="n">tr_d3_2</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tr_d3</span><span class="o">.</span><span class="n">transform_groups</span><span class="p">([</span><span class="s1">&#39;nue+nuebar&#39;</span><span class="p">])</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">tr_d3</span><span class="o">.</span><span class="n">transform_groups</span><span class="p">(</span><span class="s1">&#39;nue+nuebar, numu+numubar, nutau+nutaubar&#39;</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">):</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;&lt;&lt; PASS : test_FlavIntDataGroup &gt;&gt;&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">set_verbosity</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">test_IntType</span><span class="p">()</span>
    <span class="n">test_NuFlav</span><span class="p">()</span>
    <span class="n">test_NuFlavInt</span><span class="p">()</span>
    <span class="n">test_NuFlavIntGroup</span><span class="p">()</span>
    <span class="n">test_FlavIntData</span><span class="p">()</span>
    <span class="n">test_FlavIntDataGroup</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The IceCube/PINGU Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>