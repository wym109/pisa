<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pisa.stages.utils package &mdash; PISA 4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=9f5556dd"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="pisa.stages.xsec package" href="pisa.stages.xsec.html" />
    <link rel="prev" title="pisa.stages.reco package" href="pisa.stages.reco.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            PISA
          </a>
              <div class="version">
                4.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="modules.html">API reference</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="pisa.html">pisa package</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="pisa.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="pisa.analysis.html">pisa.analysis package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.core.html">pisa.core package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.scripts.html">pisa.scripts package</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="pisa.stages.html">pisa.stages package</a></li>
<li class="toctree-l4"><a class="reference internal" href="pisa.utils.html">pisa.utils package</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="pisa.html#module-pisa">Module contents</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PISA</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="modules.html">pisa</a></li>
          <li class="breadcrumb-item"><a href="pisa.html">pisa package</a></li>
          <li class="breadcrumb-item"><a href="pisa.stages.html">pisa.stages package</a></li>
      <li class="breadcrumb-item active">pisa.stages.utils package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pisa.stages.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pisa-stages-utils-package">
<h1>pisa.stages.utils package<a class="headerlink" href="#pisa-stages-utils-package" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-pisa.stages.utils.add_indices">
<span id="pisa-stages-utils-add-indices-module"></span><h2>pisa.stages.utils.add_indices module<a class="headerlink" href="#module-pisa.stages.utils.add_indices" title="Link to this heading"></a></h2>
<p>PISA module to prep incoming data into formats that are
compatible with the mc_uncertainty likelihood formulation</p>
<p>This module takes in events containers from the pipeline, and
introduces an additional array giving the indices where each
event falls into.</p>
<p>module structure imported from bootcamp example</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.add_indices.add_indices">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.add_indices.</span></span><span class="sig-name descname"><span class="pre">add_indices</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/add_indices.html#add_indices"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.add_indices.add_indices" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>PISA Pi stage to map out the index of the analysis
binning where each event falls into.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>params</strong> – foo : Quantity
bar : Quanitiy with time dimension</p></li>
<li><p><strong>Notes</strong></p></li>
<li><p><strong>------</strong></p></li>
<li><p><strong>module</strong> (<em>- input and calc specs are predetermined in the</em>) – (inputs from the config files will be disregarded)</p></li>
<li><p><strong>bin_indices</strong> (<em>- stage appends an array quantity called</em>)</p></li>
<li><p><strong>by</strong> (<em>- stage also appends an array mask to access events</em>) – bin index later in the pipeline</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.add_indices.add_indices.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/add_indices.html#add_indices.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.add_indices.add_indices.setup_function" title="Link to this definition"></a></dt>
<dd><p>Calculate the bin index where each event falls into</p>
<p>Create one mask for each analysis bin.</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils.adhoc_sys">
<span id="pisa-stages-utils-adhoc-sys-module"></span><h2>pisa.stages.utils.adhoc_sys module<a class="headerlink" href="#module-pisa.stages.utils.adhoc_sys" title="Link to this heading"></a></h2>
<p>Stage to implement an ad-hoc systematic that corrects the discrepancy between data and
MC in one particular variable. This can be used to check how large the impact of such a
hypothetical systematic would be on the physics parameters of an analysis.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.adhoc_sys.adhoc_sys">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.adhoc_sys.</span></span><span class="sig-name descname"><span class="pre">adhoc_sys</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variable_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/adhoc_sys.html#adhoc_sys"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.adhoc_sys.adhoc_sys" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Stage to re-weight events according to factors derived from post-fit data/MC
comparisons. The comparisons are produced somewhere externally and stored as a JSON
which encodes the binning that was used to make the comparison and the resulting
scaling factors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>variable_name</strong> (<em>str</em>) – Name of the variable to correct data/MC agreement for. The variable must be
loaded in the data loading stage and it must be present in the loaded JSON file.</p></li>
<li><p><strong>scale_file</strong> (<em>str</em>) – Path to the file which contains the binning and the scale factors. The JSON
file must contain a dictionary in which, for each variable, a 1D binning and
an array of factors. This file is produced externally from PISA.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.adhoc_sys.adhoc_sys.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/adhoc_sys.html#adhoc_sys.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.adhoc_sys.adhoc_sys.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.adhoc_sys.adhoc_sys.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/adhoc_sys.html#adhoc_sys.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.adhoc_sys.adhoc_sys.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils.bootstrap">
<span id="pisa-stages-utils-bootstrap-module"></span><h2>pisa.stages.utils.bootstrap module<a class="headerlink" href="#module-pisa.stages.utils.bootstrap" title="Link to this heading"></a></h2>
<p>Make bootstrap samples of data.</p>
<p>This stage allows one to resample datasets to estimate MC uncertainties without having
to decrease statistics. Bootstrap samples are produced by random selection with
replacement, which is implemented in this stage by an equivalent re-weighting of
events.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.bootstrap.bootstrap">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.bootstrap.</span></span><span class="sig-name descname"><span class="pre">bootstrap</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/bootstrap.html#bootstrap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.bootstrap.bootstrap" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Stage to make bootstrap samples from input data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>seed</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed for the random number generator.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.bootstrap.bootstrap.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/bootstrap.html#bootstrap.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.bootstrap.bootstrap.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.bootstrap.bootstrap.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/bootstrap.html#bootstrap.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.bootstrap.bootstrap.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.utils.bootstrap.insert_bootstrap_after_data_loader">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.bootstrap.</span></span><span class="sig-name descname"><span class="pre">insert_bootstrap_after_data_loader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cfg_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/bootstrap.html#insert_bootstrap_after_data_loader"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.bootstrap.insert_bootstrap_after_data_loader" title="Link to this definition"></a></dt>
<dd><p>Given a pipeline configuration parsed with <cite>parse_pipeline_config</cite>, insert the
bootstrap stage directly after the <cite>simple_data_loader</cite> stage and return the
modified config dict.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cfg_dict</strong> (<a class="reference internal" href="pisa.html#pisa.OrderedDict" title="collections.OrderedDict"><em>collections.OrderedDict</em></a>) – Pipeline configuration in the form of an ordered dictionary.</p></li>
<li><p><strong>seed</strong> (<em>int</em><em>, </em><em>optional</em>) – Seed to be placed into the pipeline configuration.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A deepcopy of the original input <cite>cfg_dict</cite> with the configuration of the
bootstrap stage inserted after the data loader.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><a class="reference internal" href="pisa.html#pisa.OrderedDict" title="collections.OrderedDict">collections.OrderedDict</a></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.utils.bootstrap.test_bootstrap">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.bootstrap.</span></span><span class="sig-name descname"><span class="pre">test_bootstrap</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/bootstrap.html#test_bootstrap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.bootstrap.test_bootstrap" title="Link to this definition"></a></dt>
<dd><p>Unit test for the bootstrap stage.</p>
</dd></dl>

</section>
<section id="module-pisa.stages.utils.fix_error">
<span id="pisa-stages-utils-fix-error-module"></span><h2>pisa.stages.utils.fix_error module<a class="headerlink" href="#module-pisa.stages.utils.fix_error" title="Link to this heading"></a></h2>
<p>Stage to take the initial errors of MC and keep them
for all minimization.</p>
<p>Needed for the DRAGON nutau appearance analysis.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.fix_error.fix_error">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.fix_error.</span></span><span class="sig-name descname"><span class="pre">fix_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/fix_error.html#fix_error"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.fix_error.fix_error" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>stage to fix the error returned by template_maker.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.fix_error.fix_error.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/fix_error.html#fix_error.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.fix_error.fix_error.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.fix_error.fix_error.compute_function">
<span class="sig-name descname"><span class="pre">compute_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/fix_error.html#fix_error.compute_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.fix_error.fix_error.compute_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.fix_error.fix_error.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/fix_error.html#fix_error.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.fix_error.fix_error.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils.hist">
<span id="pisa-stages-utils-hist-module"></span><h2>pisa.stages.utils.hist module<a class="headerlink" href="#module-pisa.stages.utils.hist" title="Link to this heading"></a></h2>
<p>Stage to transform arrays with weights into actual <cite>histograms</cite>
that represent event counts</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.hist.hist">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.hist.</span></span><span class="sig-name descname"><span class="pre">hist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">apply_unc_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unweighted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/hist.html#hist"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.hist.hist" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>stage to histogram events</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>unweighted</strong> (<em>bool</em><em>, </em><em>optional</em>) – Return un-weighted event counts in each bin.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.hist.hist.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/hist.html#hist.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.hist.hist.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.hist.hist.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/hist.html#hist.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.hist.hist.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils.kde">
<span id="pisa-stages-utils-kde-module"></span><h2>pisa.stages.utils.kde module<a class="headerlink" href="#module-pisa.stages.utils.kde" title="Link to this heading"></a></h2>
<p>Stage to transform arrays with weights into KDE maps
that represent event counts</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.kde.kde">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.kde.</span></span><span class="sig-name descname"><span class="pre">kde</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bw_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'silverman'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coszen_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'reco_coszen'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oversample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coszen_reflection</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.25</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stack_pid</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stash_hists</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bootstrap</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bootstrap_niter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bootstrap_seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linearize_log_dims</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/kde.html#kde"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.kde.kde" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>stage to KDE-map events</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>bw_method</strong> (<em>string</em>) – ‘scott’ or ‘silverman’ (see kde module)</p></li>
<li><p><strong>coszen_name</strong> (<em>string</em>) – Binning name to identify the coszen bin that needs to undergo special
treatment for reflection</p></li>
<li><p><strong>oversample</strong> (<em>int</em>) – Evaluate KDE at more points per bin, takes longer, but is more accurate</p></li>
<li><p><strong>stash_hists</strong> (<em>bool</em>) – Evaluate KDE only once and stash the result. This effectively ignores all changes
from earlier stages, but greatly increases speed. Useful for muons where
only over-all weight and detector systematic variations matter, which can both
be applied on the histograms after this stage.</p></li>
<li><p><strong>bootstrap</strong> (<em>bool</em>) – Use the bootstrapping technique to estimate errors on the KDE histograms.</p></li>
<li><p><strong>linearize_log_dims</strong> (<em>bool</em>) – If True (default), calculate the KDE for a dimension that is binned
logarithmically on the logarithm of the sample values. This generally results
in better agreement of the total normalization of the KDE’d histograms to the
sum of weights.</p></li>
</ul>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>Make sure enough events are present with reco energy below and above the
binning range, otherwise events will only “bleed out”</p>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.kde.kde.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/kde.html#kde.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.kde.kde.apply" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.kde.kde.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/kde.html#kde.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.kde.kde.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils.kfold">
<span id="pisa-stages-utils-kfold-module"></span><h2>pisa.stages.utils.kfold module<a class="headerlink" href="#module-pisa.stages.utils.kfold" title="Link to this heading"></a></h2>
<p>Make K-folds of data.</p>
<p>This stage can be used to split MC into chunks of equal size and to select only one
chunk to make histograms from. It uses the KFold class from scikit-learn to make
“test” and “train” indeces for the dataset and sets all weights in the “train”
indeces to zero. Optionally, weights can be re-scaled by the number of splits to
renormalize the total rates.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.kfold.kfold">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.kfold.</span></span><span class="sig-name descname"><span class="pre">kfold</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">n_splits</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">select_split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">seed</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">renormalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shuffle</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/kfold.html#kfold"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.kfold.kfold" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Stage to make splits of the MC set and select one split to make histograms.
The weight of all indeces not belonging to the selected split are set to
zero.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>(</strong><strong>int</strong><strong>)</strong> (<em>n_splits</em>)</p></li>
<li><p><strong>(</strong><strong>int</strong> (<em>seed</em>)</p></li>
<li><p><strong>optional</strong><strong>)</strong> (<em>shuffle indeces before splitting</em>)</p></li>
<li><p><strong>(</strong><strong>int</strong></p></li>
<li><p><strong>optional</strong><strong>)</strong></p></li>
<li><p><strong>(</strong><strong>bool</strong> (<em>shuffle</em>) – by the number of splits</p></li>
<li><p><strong>optional</strong><strong>)</strong> – by the number of splits</p></li>
<li><p><strong>(</strong><strong>bool</strong></p></li>
<li><p><strong>optional</strong><strong>)</strong></p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.kfold.kfold.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/kfold.html#kfold.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.kfold.kfold.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.kfold.kfold.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/kfold.html#kfold.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.kfold.kfold.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils.resample">
<span id="pisa-stages-utils-resample-module"></span><h2>pisa.stages.utils.resample module<a class="headerlink" href="#module-pisa.stages.utils.resample" title="Link to this heading"></a></h2>
<p>Stage to transform binned data from one binning to another while also dealing with
uncertainty estimates in a reasonable way. In particular, this allows up-sampling from a
more coarse binning to a finer binning.</p>
<p>The implementation is similar to that of the hist stage, hence the over-writing of
the <cite>apply</cite> method.</p>
<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.ResampleMode">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.resample.</span></span><span class="sig-name descname"><span class="pre">ResampleMode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/resample.html#ResampleMode"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.resample.ResampleMode" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Enum</span></code></p>
<p>Enumerates sampling methods of the <cite>resample</cite> stage.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.ResampleMode.ARB">
<span class="sig-name descname"><span class="pre">ARB</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">3</span></em><a class="headerlink" href="#pisa.stages.utils.resample.ResampleMode.ARB" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.ResampleMode.DOWN">
<span class="sig-name descname"><span class="pre">DOWN</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2</span></em><a class="headerlink" href="#pisa.stages.utils.resample.ResampleMode.DOWN" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.ResampleMode.UP">
<span class="sig-name descname"><span class="pre">UP</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1</span></em><a class="headerlink" href="#pisa.stages.utils.resample.ResampleMode.UP" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.resample">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.resample.</span></span><span class="sig-name descname"><span class="pre">resample</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">scale_errors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/resample.html#resample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.resample.resample" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Stage to resample weighted MC histograms from one binning to another.</p>
<p>The origin binning is given as <cite>calc_mode</cite> and the output binning is given in
<cite>apply_mode</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>scale_errors</strong> (<em>bool</em><em>, </em><em>optional</em>) – If <cite>True</cite> (default), apply scaling to errors.</p>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.resample.apply">
<span class="sig-name descname"><span class="pre">apply</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/resample.html#resample.apply"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.resample.resample.apply" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.resample.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/resample.html#resample.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.resample.resample.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.utils.resample.test_resample">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.resample.</span></span><span class="sig-name descname"><span class="pre">test_resample</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/resample.html#test_resample"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.resample.test_resample" title="Link to this definition"></a></dt>
<dd><p>Unit test for the resampling stage.</p>
</dd></dl>

</section>
<section id="module-pisa.stages.utils.set_variance">
<span id="pisa-stages-utils-set-variance-module"></span><h2>pisa.stages.utils.set_variance module<a class="headerlink" href="#module-pisa.stages.utils.set_variance" title="Link to this heading"></a></h2>
<p>Override errors and replace with manually chosen error fraction.</p>
<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.utils.set_variance.apply_floor">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.set_variance.</span></span><span class="sig-name descname"><span class="pre">apply_floor</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/set_variance.html#apply_floor"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.set_variance.apply_floor" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="pisa.stages.utils.set_variance.set_constant">
<span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.set_variance.</span></span><span class="sig-name descname"><span class="pre">set_constant</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/set_variance.html#set_constant"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.set_variance.set_constant" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="pisa.stages.utils.set_variance.set_variance">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">pisa.stages.utils.set_variance.</span></span><span class="sig-name descname"><span class="pre">set_variance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">variance_scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">variance_floor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expected_total_mc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">divide_total_mc</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">std_kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/set_variance.html#set_variance"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.set_variance.set_variance" title="Link to this definition"></a></dt>
<dd><p>Bases: <a class="reference internal" href="pisa.core.html#pisa.core.stage.Stage" title="pisa.core.stage.Stage"><code class="xref py py-class docutils literal notranslate"><span class="pre">Stage</span></code></a></p>
<p>Override errors and replace with manually chosen variance.</p>
<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.set_variance.set_variance.apply_function">
<span class="sig-name descname"><span class="pre">apply_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/set_variance.html#set_variance.apply_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.set_variance.set_variance.apply_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.set_variance.set_variance.compute_function">
<span class="sig-name descname"><span class="pre">compute_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/set_variance.html#set_variance.compute_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.set_variance.set_variance.compute_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="pisa.stages.utils.set_variance.set_variance.setup_function">
<span class="sig-name descname"><span class="pre">setup_function</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/pisa/stages/utils/set_variance.html#set_variance.setup_function"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#pisa.stages.utils.set_variance.set_variance.setup_function" title="Link to this definition"></a></dt>
<dd><p>Implement in services (subclasses of Stage)</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-pisa.stages.utils">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pisa.stages.utils" title="Link to this heading"></a></h2>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pisa.stages.reco.html" class="btn btn-neutral float-left" title="pisa.stages.reco package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="pisa.stages.xsec.html" class="btn btn-neutral float-right" title="pisa.stages.xsec package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The IceCube/PINGU Collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>